{
  "data": "<?xml version=\"1.0\" encoding=\"UTF-8\"?><rss xmlns:dc=\"http://purl.org/dc/elements/1.1/\" xmlns:content=\"http://purl.org/rss/1.0/modules/content/\" xmlns:atom=\"http://www.w3.org/2005/Atom\" version=\"2.0\"><channel><title><![CDATA[Writing by Rolf Erik Lekang]]></title><description><![CDATA[Writing by Rolf Erik Lekang]]></description><link>https://rolflekang.com</link><generator>GatsbyJS</generator><lastBuildDate>Sat, 12 Sep 2020 14:51:45 GMT</lastBuildDate><item><title><![CDATA[Using Ansible handlers in loops]]></title><description><![CDATA[Recently I have been dusting of my old ansible playbooks that I use to deploy personal\nstuff. Everything from side projects like feedhuddler‚Ä¶]]></description><link>https://rolflekang.com/ansible-handlers-in-loops</link><guid isPermaLink=\"false\">https://rolflekang.com/ansible-handlers-in-loops</guid><category><![CDATA[ansible]]></category><category><![CDATA[devops]]></category><category><![CDATA[ops]]></category><category><![CDATA[infrastructure-as-code]]></category><pubDate>Sat, 12 Sep 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Recently I have been dusting of my old ansible playbooks that I use to deploy personal\nstuff. Everything from side projects like &lt;a href=&quot;https://feedhuddler.com&quot;&gt;feedhuddler.com&lt;/a&gt; to the unifi controller for\nmy home network. In that setup I have a projects role that takes a list of projects and\ndeploy them either running directly on the host with systemd services or docker containers.\nThe systemd setup was using a task to restart the service after changing them. I wanted to\nchange this to be done with a handler instead. However, handlers does not accept arguments.\nThe posts describes a workaround for that problem, enabling dynamic use of handlers.&lt;/p&gt;\n&lt;p&gt;First let us look at what a handler is and how it differs from a task. The handlers are\nactions that can be triggered by other tasks. On a task you can define which handlers they\nshould trigger. Very useful for things like &quot;Configuration file was updated so we want to restart\nan application&quot;. A nice feature is that these handlers are triggered at the end of the playbook,\nand they only run once. Thus, if you have 5 tasks that triggers the same handler it will only\nrun once at the end.&lt;/p&gt;\n&lt;p&gt;The problem at hand is that handlers does not accept any arguments. Thus, when a task have a loop\ngoing through a list of projects it is not straight forward how to be able to keep one handler for\nall these services. Below is an example setup, we will be looking at single file playbooks to make\nit easier to follow the changes that would usually be across different files in roles.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yml&quot;&gt;&lt;pre class=&quot;language-yml&quot;&gt;&lt;code class=&quot;language-yml&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; all\n  &lt;span class=&quot;token key atrule&quot;&gt;vars&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n    &lt;span class=&quot;token key atrule&quot;&gt;projects&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; super&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;project\n        &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4000&lt;/span&gt;\n      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; not&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;so&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;super&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;project\n        &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5000&lt;/span&gt;\n  &lt;span class=&quot;token key atrule&quot;&gt;tasks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Create systemd config for {{ item.name }}&apos;&lt;/span&gt;\n      &lt;span class=&quot;token key atrule&quot;&gt;loop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;{{ projects }}&apos;&lt;/span&gt;\n      &lt;span class=&quot;token key atrule&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n        &lt;span class=&quot;token key atrule&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; web.service.jinja2\n        &lt;span class=&quot;token key atrule&quot;&gt;dest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /etc/systemd/system/&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; item.name &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;.service\n        &lt;span class=&quot;token key atrule&quot;&gt;owner&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; root\n        &lt;span class=&quot;token key atrule&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; root\n      &lt;span class=&quot;token key atrule&quot;&gt;notify&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; reload systemd\n        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;restart {{ item.name }}&apos;&lt;/span&gt;\n\n  &lt;span class=&quot;token key atrule&quot;&gt;handlers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; reload systemd\n      &lt;span class=&quot;token key atrule&quot;&gt;systemd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n        &lt;span class=&quot;token key atrule&quot;&gt;daemon_reload&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; yes\n    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; restart super&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;project\n      &lt;span class=&quot;token key atrule&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n        &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;{{ item }}&apos;&lt;/span&gt;\n        &lt;span class=&quot;token key atrule&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; restarted\n    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; restart not&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;so&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;super&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;project\n      &lt;span class=&quot;token key atrule&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n        &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;{{ item }}&apos;&lt;/span&gt;\n        &lt;span class=&quot;token key atrule&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; restarted&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;This works, but when adding a new project it is necessary to add a new handler. This is not the end of\nthe world. However, I do not touch this code very often and when I do it is usually because I need to\nchange the configuration for a service or add a new service. Thus, it would be nice to be able to that without\nediting the role every time.&lt;/p&gt;\n&lt;p&gt;There is another feature in ansible we can use to work around the fact that handlers does not support\narguments. Each task has the ability to store the result in a variable, and if the task has a loop that\nvariable will be a list of these results. This is done by adding &lt;code class=&quot;language-text&quot;&gt;register: variable_name&lt;/code&gt; to the task.\nEven though handlers does not work with arguments, it has access to the global variable scope. This means\nwe can make a handler looping over the result and restart the services. See the highlighted changes below.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yml&quot;&gt;&lt;pre class=&quot;language-yml&quot;&gt;&lt;code class=&quot;language-yml&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;hosts&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; all\n  &lt;span class=&quot;token key atrule&quot;&gt;vars&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n    &lt;span class=&quot;token key atrule&quot;&gt;projects&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; super&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;project\n        &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4000&lt;/span&gt;\n      &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; not&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;so&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;super&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;project\n        &lt;span class=&quot;token key atrule&quot;&gt;port&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5000&lt;/span&gt;\n  &lt;span class=&quot;token key atrule&quot;&gt;tasks&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Create systemd config for projects\n      &lt;span class=&quot;token key atrule&quot;&gt;loop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;{{ projects }}&apos;&lt;/span&gt;\n      &lt;span class=&quot;token key atrule&quot;&gt;template&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n        &lt;span class=&quot;token key atrule&quot;&gt;src&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; web.service.jinja2\n        &lt;span class=&quot;token key atrule&quot;&gt;dest&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /etc/systemd/system/&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; item.name &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;.service\n        &lt;span class=&quot;token key atrule&quot;&gt;owner&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; root\n        &lt;span class=&quot;token key atrule&quot;&gt;group&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; root\n&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;      &lt;span class=&quot;token key atrule&quot;&gt;register&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; systemd_projects&lt;/span&gt;      &lt;span class=&quot;token key atrule&quot;&gt;notify&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; reload systemd\n&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;        &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; restart systemd projects&lt;/span&gt;\n  &lt;span class=&quot;token key atrule&quot;&gt;handlers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; reload systemd\n      &lt;span class=&quot;token key atrule&quot;&gt;systemd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n        &lt;span class=&quot;token key atrule&quot;&gt;daemon_reload&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; yes\n&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; restart systemd projects&lt;/span&gt;&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;      &lt;span class=&quot;token key atrule&quot;&gt;loop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;{{ systemd_projects.results | selectattr(&apos;changed&apos;, &apos;equalto&apos;, true) | map(attribute=&apos;item&apos;) | map(attribute=&apos;name&apos;) | list }}&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;      &lt;span class=&quot;token key atrule&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;        &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;{{ item }}&apos;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;        &lt;span class=&quot;token key atrule&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; restarted&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;The playbook now have one handler for restarting the projects: &lt;code class=&quot;language-text&quot;&gt;restart systemd projects&lt;/code&gt;. Let&apos;s have a closer look\nat the loop for that handler. &lt;code class=&quot;language-text&quot;&gt;systemd_projects.results&lt;/code&gt; is the result list from the task above creating the\nsystemd service files. &lt;code class=&quot;language-text&quot;&gt;selectattr(&amp;#39;changed&amp;#39;, &amp;#39;equalto&amp;#39;, true)&lt;/code&gt; is a filter that will select only the items\nin the list that has a property changed set to true. The two next filters &lt;code class=&quot;language-text&quot;&gt;map(attribute=&amp;#39;item&amp;#39;) | map(attribute=&amp;#39;name&amp;#39;)&lt;/code&gt;\nmaps the items to certain attributes. The last filter &lt;code class=&quot;language-text&quot;&gt;list&lt;/code&gt; converts a generator into a list.&lt;/p&gt;\n&lt;p&gt;This means that this list&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;changed&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;item&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;super-project&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;port&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4000&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;changed&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;item&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;not-so-super-project&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token property&quot;&gt;&quot;port&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5000&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;would turn into&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;super-project&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;which in turn would result in the handler running&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yml&quot;&gt;&lt;pre class=&quot;language-yml&quot;&gt;&lt;code class=&quot;language-yml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;service&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n  &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; super&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;project\n  &lt;span class=&quot;token key atrule&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; restarted&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;In other words, we have a dynamic handler that can restart services based on changes so that we can\nfocus on only the configuration whenever there is a new side-project to deploy.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Serving text/plain for curl with Next]]></title><description><![CDATA[I have recently been trying out the Next.js for some projects again. I have\nhad earlier projects where I have been really happy with Next‚Ä¶]]></description><link>https://rolflekang.com/serving-plain-text-with-nextjs</link><guid isPermaLink=\"false\">https://rolflekang.com/serving-plain-text-with-nextjs</guid><category><![CDATA[nextjs]]></category><category><![CDATA[javascript]]></category><category><![CDATA[curl]]></category><category><![CDATA[nodejs]]></category><pubDate>Tue, 26 May 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I have recently been trying out the &lt;a href=&quot;https://nextjs.org/&quot;&gt;Next.js&lt;/a&gt; for some projects again. I have\nhad earlier projects where I have been really happy with Next, but for some time now\n&lt;a href=&quot;https://www.gatsbyjs.org/&quot;&gt;Gatsby&lt;/a&gt; has been my go to. One of the big things separating these two are that Next\nhas runtime server side rendering and thought it would be a neat to utilize this to\nhave separate content-types based on the client. The idea is that if the client is a\nCLI based client like &lt;a href=&quot;https://curl.haxx.se/&quot;&gt;curl&lt;/a&gt; the server should respond with a plain text response.\nThis should not be the case if the accept header is set to something specific. The\ndefault accept header in curl is &lt;code class=&quot;language-text&quot;&gt;*/*&lt;/code&gt;.&lt;/p&gt;\n&lt;p&gt;Next has a feature where you can drop in your own http server and still let the\nframework handle the rendering. This is helpful in many situations like protecting\nthings with login or using Next as a part of an already existing application. Below is\na minimal custom server. The highlighted line is where the rendering of the response\nis handed of to Next.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; createServer &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;http&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; parse &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;url&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; next &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;next&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n\n&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; dev &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;NODE_ENV&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;production&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; app &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; dev &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; handle &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getRequestHandler&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; port &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;parseInt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;process&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;env&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;PORT&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;3000&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n\napp&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;prepare&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n  &lt;span class=&quot;token function&quot;&gt;createServer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; res&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; parsedUrl &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;parse&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;req&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;    &lt;span class=&quot;token function&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; res&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; parsedUrl&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;listen&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;port&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token parameter&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&gt; Ready on http://localhost:&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;port&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;This custom server does nothing that the default Next server does not, so putting this\na project does not make very much sense unless one adds something more. That said, if\nthis is put in &lt;code class=&quot;language-text&quot;&gt;server.js&lt;/code&gt; in a Next project running &lt;code class=&quot;language-text&quot;&gt;node server.js&lt;/code&gt; in dev and\n&lt;code class=&quot;language-text&quot;&gt;NODE_ENV=production node server.js&lt;/code&gt; in production should work nicely.&lt;/p&gt;\n&lt;p&gt;To achieve the custom content type responses without duplicating the content we can\nuse Next to render the content. Then we will pass it through a npm module that returns\ntext from HTML. It could also be interesting to do the same with something that returns\nmarkdown if you want to keep more of semantic elements. In order to get the html from\nNext we need to give it a fake response that we can read from afterwords. I will admit,\nthis is a hack, but hey it works. ü§∑‚Äç‚ôÇÔ∏è&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;FakeResponse&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;EventEmitter&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n  &lt;span class=&quot;token function&quot;&gt;constructor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;super&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;headers &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n\n  &lt;span class=&quot;token function&quot;&gt;getHeader&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;headers&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n\n  &lt;span class=&quot;token function&quot;&gt;setHeader&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;headers&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; value&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n\n  &lt;span class=&quot;token function&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n\n  &lt;span class=&quot;token function&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;this&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;emit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;end&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;The class above emulates the part of Node&apos;s &lt;code class=&quot;language-text&quot;&gt;http.ServerResponse&lt;/code&gt; that is needed and emits\n&lt;code class=&quot;language-text&quot;&gt;end&lt;/code&gt; when the response is done. This makes it possible to get the HTML generated by Next\nand the headers set by Next. Below is a function that takes the same arguments as Next&apos;s\nhandle function, but it uses the fake response to get the generated HTML and pass that to\n&lt;a href=&quot;https://www.npmjs.com/package/html-to-text&quot;&gt;html-to-text&lt;/a&gt;. It also copies all the headers from the fake response to the real response.\n&lt;code class=&quot;language-text&quot;&gt;Content-Length&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;Content-Type&lt;/code&gt; is excluded from this copying since those will be\ndifferent from what Next has set.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;handleWithText&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; res&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; parsedUrl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; fakeRes &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;FakeResponse&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  fakeRes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;end&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token parameter&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    Object&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;keys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;fakeRes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;headers&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;key&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Content-Length&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; key &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Content-Type&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n        res&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setHeader&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; fakeRes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getHeader&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    res&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;setHeader&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Content-Type&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;text/plain&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    res&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;statusCode &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; fakeRes&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;statusCode &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt;\n    res&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;end&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;htmlToText&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fromString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token function&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; fakeRes&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; parsedUrl&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;With that set up, the custom server code can be changed to the following. The code\nbelow checks the accept header and uses the new &lt;code class=&quot;language-text&quot;&gt;handleWithText&lt;/code&gt; function if the\naccept header is set to &lt;code class=&quot;language-text&quot;&gt;text/plain&lt;/code&gt; or the user agent is &lt;a href=&quot;https://curl.haxx.se/&quot;&gt;curl&lt;/a&gt; or &lt;a href=&quot;https://httpie.org/&quot;&gt;httpie&lt;/a&gt;,\nthe two CLI based http clients I know of, with an accept header set to &lt;code class=&quot;language-text&quot;&gt;*/*&lt;/code&gt;.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;prepare&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n  &lt;span class=&quot;token function&quot;&gt;createServer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; res&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; parsedUrl &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;parse&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;req&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;accept&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;req&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;headers&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;accept&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n\n    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;\n      accept &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;text/plain&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt;\n      &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;accept &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;*/*&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token regex&quot;&gt;/curl|HTTPie/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;req&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;headers&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;user-agent&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n      &lt;span class=&quot;token function&quot;&gt;handleWithText&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; res&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; parsedUrl&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n      &lt;span class=&quot;token function&quot;&gt;handle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; res&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; parsedUrl&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;listen&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;port&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token parameter&quot;&gt;err&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;err&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; err&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&gt; Ready on http://localhost:&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;port&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;This would result in this output if it would be used on the front page of this website\n(which would require me to rewrite it from Gatsby first, but that is another thing).&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ curl -L rolflekang.com\nRL [/]\n\nHi, I am Rolf\n\nI am an independent software developer who enjoys working\nwith the whole stack. I occationally write posts [/writing], take photographs\n[/photography], ride mountain bikes and snowboards. I do consulting work, if\nthat is something you are looking I might be able to help out [/hire].&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;This might not be the most useful feature, but it might be neat if your website\ncontains information that people often would want to get from the terminal. Anyhow,\nit is a fun little easter egg. üê£&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Wireless uplinks with Unifi]]></title><description><![CDATA[In the apartment I live in there is only ethernet between the place where the fiber\nconnection is and the tv point in the living room. In‚Ä¶]]></description><link>https://rolflekang.com/wireless-uplinks-with-unifi</link><guid isPermaLink=\"false\">https://rolflekang.com/wireless-uplinks-with-unifi</guid><category><![CDATA[networking]]></category><category><![CDATA[unifi]]></category><category><![CDATA[ubiquiti]]></category><category><![CDATA[homelab]]></category><pubDate>Sun, 03 May 2020 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;In the apartment I live in there is only ethernet between the place where the fiber\nconnection is and the tv point in the living room. In the place with where the fiber\nconnection is located there is a technical closet without room for anything more than\nthe ISP modem. Thus, we have an home office without an ethernet connection. In that office\nwe need some equipment that gives a lot more value if we are connected to it with gigabit\nethernet.&lt;/p&gt;\n&lt;p&gt;I already had the network set up with Ubiquiti Unifi equipment that I am quite happy with\nso I looked into if I could have two different wired networks and have them connected with\nwifi. They have a feature called wireless uplinks, which is usually used to create mesh\nnetworks, but it can also be used to share the wireless connection with a switch. I decided\nto buy another access point and switch to try to connect everything. The experience of setting\nit up was straight forward. I connected the switch first to another switch and updated an\nadopted it. Then I disconnected it from the switch and connected the access point and adopted\nthe access point which then reconnected the switch.&lt;/p&gt;\n&lt;p&gt;The setup is as following. In the office there is an unifi nanoHD connected to a 8 port &lt;abbr title=&quot;Power Over Ethernet&quot;&gt;POE&lt;/abbr&gt; switch.\nThe nanoHD is connected to a unifi flexHD over wireless uplink, which again is also connected to a\n8 port &lt;abbr title=&quot;Power Over Ethernet&quot;&gt;POE&lt;/abbr&gt; switch. The diagram below will hopefully make it clear. I started out with the Unifi mesh\naccess point but figured I would get more speed with a more high end access point.&lt;/p&gt;\n&lt;br /&gt;\n&lt;br /&gt;\n&lt;p&gt;&lt;span\n      class=&quot;gatsby-resp-image-wrapper&quot;\n      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 640px;&quot;\n    &gt;\n      &lt;a\n    class=&quot;gatsby-resp-image-link&quot;\n    href=&quot;/static/0903810b05ba9955217c2178b498c8b3/6af66/wireless-uplink-diagram.png&quot;\n    style=&quot;display: block&quot;\n    target=&quot;_blank&quot;\n    rel=&quot;noopener&quot;\n  &gt;\n    &lt;span\n    class=&quot;gatsby-resp-image-background-image&quot;\n    style=&quot;padding-bottom: 14.893617021276595%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsSAAALEgHS3X78AAAA7ElEQVQI12PYsn238Jw580SraxpEC4rKJBiA4Obdh0HXb9/vBLH3HTjMXFhawQhif/r8teb9x887X758pQTib9m+k2/mrDliU6fPFgXh2XPmCTMsWrr88sSJk0/39/cfa2ttudve3ln18MHDqGtXry0AaYqIiOAGUkzrV6+QePP+838QePjoST1IbsHiZVMnTZp8c/r06cemTpl6dvr0mWcZ+iZO5tbS0pbR1dFWzclMFQcpvHbtusGNGzeDQOwNGzYy1dc3gl347PnLsucvXm28/+CRAtiFO/ZyODs7i6mpKKtamZtKLVywkBsAcJ9ue2L09AQAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;\n  &gt;&lt;/span&gt;\n  &lt;img\n        class=&quot;gatsby-resp-image-image&quot;\n        alt=&quot;Diagram of network connections&quot;\n        title=&quot;Diagram of network connections&quot;\n        src=&quot;/static/0903810b05ba9955217c2178b498c8b3/6af66/wireless-uplink-diagram.png&quot;\n        srcset=&quot;/static/0903810b05ba9955217c2178b498c8b3/4dcb9/wireless-uplink-diagram.png 188w,\n/static/0903810b05ba9955217c2178b498c8b3/5ff7e/wireless-uplink-diagram.png 375w,\n/static/0903810b05ba9955217c2178b498c8b3/6af66/wireless-uplink-diagram.png 640w&quot;\n        sizes=&quot;(max-width: 640px) 100vw, 640px&quot;\n        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;\n        loading=&quot;lazy&quot;\n      /&gt;\n  &lt;/a&gt;\n    &lt;/span&gt;&lt;/p&gt;\n&lt;br /&gt;\n&lt;br /&gt;\n&lt;p&gt;This setup has been working nicely. The speeds do vary, which I guess is due to inference, but it is\nmore than acceptable as an uplink to the computers and the network storage connected to it.&lt;/p&gt;\n&lt;h2&gt;A few tips when setting up with wireless uplinks&lt;/h2&gt;\n&lt;ul&gt;\n&lt;li&gt;Set the channel explicitly. This is probably a good idea wether you use wireless\nuplinks or not.&lt;/li&gt;\n&lt;li&gt;If you are moving an endpoint that was previously using wired uplinks it might help\nto reset it and adopt it over a wireless connection.&lt;/li&gt;\n&lt;li&gt;Turn off the wireless networks on the AP that does only have a wireless uplink. If\nyou don&apos;t need it for extending range this will keep your wireless network faster.&lt;/li&gt;\n&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Using git commits instead of git stash]]></title><description><![CDATA[Over the years I have time and time again run into the problem of getting\nconflicts when popping from the git stash. Somehow this has‚Ä¶]]></description><link>https://rolflekang.com/using-git-commits-instead-of-stash</link><guid isPermaLink=\"false\">https://rolflekang.com/using-git-commits-instead-of-stash</guid><category><![CDATA[git]]></category><pubDate>Thu, 14 Nov 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Over the years I have time and time again run into the problem of getting\nconflicts when popping from the git stash. Somehow this has resulted in loss\nof parts of the work I have done. There is probably a correct way to use stash\nin these situations. However, commits is a much bigger part of my workflow and\nI have deeper knowledge of how to work with commits. Furthermore, if I learn\nmore about tricks around commits it will be helpful in the rest of my workflow.&lt;/p&gt;\n&lt;p&gt;I started to use wip commits a lot instead. I just add everything and commit it\nwith the commit message &lt;code class=&quot;language-text&quot;&gt;wip&lt;/code&gt;. Git has this nice feature to make new commands\nthat are either aliases to other git commands or shell commands. To aid working\nwith wip commits I created these two aliases:&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ini&quot;&gt;&lt;pre class=&quot;language-ini&quot;&gt;&lt;code class=&quot;language-ini&quot;&gt;&lt;span class=&quot;token constant&quot;&gt;wip&lt;/span&gt; &lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; &quot;!git add . &amp;amp;&amp;amp; git commit -nm&apos;wip&apos;&quot;&lt;/span&gt;\n&lt;span class=&quot;token constant&quot;&gt;pop&lt;/span&gt; &lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; reset HEAD^&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;The first alias, wip, does two git operation through a shell command. The exclamation\nmark in the beginning of the alias indicates that this is a shell command. The\nfirst operation is adding everything in the current folder, and then the\nsecond operation is committing the changes. The flag &lt;code class=&quot;language-text&quot;&gt;-n&lt;/code&gt; in this command\ntells git to skip any pre-commit hooks since I don&apos;t want a linter or anything\nstopping the creation of the wip commit.&lt;/p&gt;\n&lt;p&gt;The second alias, pop, will remove the last commit and unstage the changes. This means\nthat if I do some changes in a repo and run &lt;code class=&quot;language-text&quot;&gt;git wip&lt;/code&gt; and then &lt;code class=&quot;language-text&quot;&gt;git pop&lt;/code&gt; the state\nwould be the same after &lt;code class=&quot;language-text&quot;&gt;git pop&lt;/code&gt; as it was before &lt;code class=&quot;language-text&quot;&gt;git wip&lt;/code&gt;.&lt;/p&gt;\n&lt;p&gt;Adding this to my workflow has made it much easier to put away work temporary by\nrunning git wip in a branch. Or rebasing my current work on the latest master,\nwhich has the possibility of creating tedious conflict situations.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Twitter cards for Gatsby posts]]></title><description><![CDATA[Previously this blog had the default article twitter card. I have seen some\nother sited like dev.to have these nice title images for the‚Ä¶]]></description><link>https://rolflekang.com/twitter-cards-for-gatsby-posts</link><guid isPermaLink=\"false\">https://rolflekang.com/twitter-cards-for-gatsby-posts</guid><category><![CDATA[gatsby]]></category><category><![CDATA[canvas]]></category><category><![CDATA[javascript]]></category><pubDate>Tue, 26 Feb 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Previously this blog had the default article twitter card. I have seen some\nother sited like &lt;a href=&quot;https://dev.to/&quot;&gt;dev.to&lt;/a&gt; have these nice title images for the twitter cards.\nI wanted to add these to this site for two reasons: they look kind of nice and\nI would like to look into what it would take to create these. The idea I had\nfor my own cards was for it to resemble the current header with RL and the\npurple line and then the title of the post below it. This first version\nwas written with Node.js and &lt;a href=&quot;https://github.com/Automattic/node-canvas&quot;&gt;node-canvas&lt;/a&gt;, maybe in the feature I will try\nto convert it to native reason. Here is a preview of the twitter card for this\npost.&lt;/p&gt;\n&lt;p&gt;&lt;img\n  src=&quot;/twitter-cards-for-gatsby-posts-link-card.png&quot;\n  alt=&quot;Twitter card for this post&quot;\n  style=&quot;border: 1px solid gray; border-radius: 20px; display: block;&quot;\n/&gt;&lt;/p&gt;\n&lt;p&gt;Twitter has &lt;a href=&quot;https://cards-dev.twitter.com/validator&quot;&gt;a tool to validate&lt;/a&gt; the cards for different\npages. It will show how the card will be viewed in a tweet. Below is an\nexample with this post.&lt;/p&gt;\n&lt;p&gt;&lt;span\n      class=&quot;gatsby-resp-image-wrapper&quot;\n      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 750px;&quot;\n    &gt;\n      &lt;a\n    class=&quot;gatsby-resp-image-link&quot;\n    href=&quot;/static/36777abb8ab99f65a937a1d20bc6178f/1ff84/card-screenshot.png&quot;\n    style=&quot;display: block&quot;\n    target=&quot;_blank&quot;\n    rel=&quot;noopener&quot;\n  &gt;\n    &lt;span\n    class=&quot;gatsby-resp-image-background-image&quot;\n    style=&quot;padding-bottom: 76.59574468085107%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB9klEQVQ4y61TyW7UQBDNLyPBp/ATHCEXTgHBIRFBIplkNDPelx6H2O143+1HV9uehWEQB0p66u7q8vMr1esL0zLx6s1r6LoOVVVhmiY0TYPjOAjDUKKuazRNIzCu+/O4xzCAou97XGRZBt0wUBQFoihCHCdI0xRJksD3fYQ8FGsAzjkCsQZBIPME2hOIaEeIKQbs43D/LzEIhb1A1wlCYp1BFzv0I+2T4WPzzcDLzxjWI0PCsx3JjDm6rhsJKdUfktEfu7GN+09rfHl3K9ebD3cIvWhq77h+kApnQkqcaefxq4LLt1dCpYnvHx/g6T7yuPxjbddPLVPUVYMyqySKtESelGibDvef11jdaLi7WuH6/Q+p0lg4aOoWhagpslJ+U+U0+XZPGPkptuozuBMhdGOELIZvheCuOLMEL14ic1zcRU8pAlE31z5bXCov82rf8hxs60LVVSiagoD7YB6DqqmwXVvcMXm/3qzgipXudENDlqfHLcshTFPlwneWZcG2bek9xhhsy8aWbeF5nsyT8anG0A0YwsPkX4p2Hso48l4a+vAVkNmrqprO7V+9SIK6Q8K2bbFYPGCjKFivN1KFIvbL5VI+Sdd1d6/hd5zYZv5DWQtVVS3QSF+eqBhOvXfswwPbyMHsSCZzn1FyDv08FJL6P0BcvwC0soPIDRnrOQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;\n  &gt;&lt;/span&gt;\n  &lt;img\n        class=&quot;gatsby-resp-image-image&quot;\n        alt=&quot;Screenshot of a twitter card&quot;\n        title=&quot;Screenshot of a twitter card&quot;\n        src=&quot;/static/36777abb8ab99f65a937a1d20bc6178f/1d69c/card-screenshot.png&quot;\n        srcset=&quot;/static/36777abb8ab99f65a937a1d20bc6178f/4dcb9/card-screenshot.png 188w,\n/static/36777abb8ab99f65a937a1d20bc6178f/5ff7e/card-screenshot.png 375w,\n/static/36777abb8ab99f65a937a1d20bc6178f/1d69c/card-screenshot.png 750w,\n/static/36777abb8ab99f65a937a1d20bc6178f/1ff84/card-screenshot.png 1040w&quot;\n        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;\n        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;\n        loading=&quot;lazy&quot;\n      /&gt;\n  &lt;/a&gt;\n    &lt;/span&gt;&lt;/p&gt;\n&lt;p&gt;So how to build this? Two things is necessary to get this to work. Creating\nthe image and then add the meta tags to each posts according to the twitter\ndocumentation.&lt;/p&gt;\n&lt;p&gt;Firstly, let us look at the creating of the images themselves. &lt;a href=&quot;https://github.com/Automattic/node-canvas&quot;&gt;node-canvas&lt;/a&gt;\nis a nice tool to do drawing in Node.js that we want to store in a file. It\ncan do many of the things possible to do with browser side canvas. Below is\nthe implementation of the card for this site. What parts each section draws\nis put in comments above them. In the end of the function the\n&lt;code class=&quot;language-text&quot;&gt;canvas.toBuffer(&amp;#39;image/png&amp;#39;)&lt;/code&gt; function is used to create a buffer that we\ncan write to a file, which then is written to the file.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; createCanvas &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;canvas&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; fs &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;fs&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n\n&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createLinkCards&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; title&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; path &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; canvas &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createCanvas&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;600&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;300&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; context &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; canvas&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getContext&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;2d&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n\n  &lt;span class=&quot;token comment&quot;&gt;// Create a white background&lt;/span&gt;\n  context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fillStyle &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;white&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fillRect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; canvas&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;width&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; canvas&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;height&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n\n  &lt;span class=&quot;token comment&quot;&gt;// Create the big RL in purple&lt;/span&gt;\n  context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;font &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;100pt serif&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fillStyle &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;#6C3082&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; header &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;measureText&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;RL&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fillText&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;RL&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;canvas&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;width &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; header&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;width&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;160&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n\n  &lt;span class=&quot;token comment&quot;&gt;// Create the purple line across the image&lt;/span&gt;\n  context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;strokeStyle &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;#6C3082&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;beginPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;lineTo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;180&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;lineTo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;canvas&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;width&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;180&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;lineWidth &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;stroke&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n\n  &lt;span class=&quot;token comment&quot;&gt;// Insert the title text beneath the purple line&lt;/span&gt;\n  &lt;span class=&quot;token function&quot;&gt;setFontSizeForWidth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;canvas&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;width &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.75&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n  context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fillStyle &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;black&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; text &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;measureText&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;title&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fillText&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;title&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;canvas&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;width &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; text&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;width&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;250&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n\n  fs&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;writeFileSync&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;path&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; canvas&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toBuffer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;image/png&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;There are a few things to take a closer look at. Several places\n&lt;code class=&quot;language-text&quot;&gt;context.measureText&lt;/code&gt; is used. It will take use the current font config to\nmeasure how wide the string passed as the first argument will be. This is\nuseful to center the text since we can use it to calculate the placement of\nthe text. Furthermore, it can be used to decide the font size if we do not\nknow the amount of text to render beforehand. In this case, that is done for\nthe title with the function below, which will test any font size from 100pt\nand downwards until the text fits within a certain limit. In the case of the\ncard title it is set to 75 % of the canvas with.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setFontSizeForWidth&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;context&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; width&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; fontSize &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;100&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    fontSize&lt;span class=&quot;token operator&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;font &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; fontSize &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;pt serif&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;context&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;measureText&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;title&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;width &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; width&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; fontSize&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;The next thing needed is to call the &lt;code class=&quot;language-text&quot;&gt;createLinkCards&lt;/code&gt; in the same place\nwhere &lt;code class=&quot;language-text&quot;&gt;createPage&lt;/code&gt; is called in &lt;code class=&quot;language-text&quot;&gt;gatsby-node.js&lt;/code&gt;. In this example I have used\n&lt;a href=&quot;https://www.gatsbyjs.org/packages/gatsby-transformer-remark/&quot;&gt;gatsby-transformer-remark&lt;/a&gt; the code snippet below is looping over the result\nof the graphql query similar to the documentation for\n&lt;a href=&quot;https://www.gatsbyjs.org/packages/gatsby-transformer-remark/&quot;&gt;gatsby-transformer-remark&lt;/a&gt;.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;posts&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; node &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; slug&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; layout&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; tags&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; title &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; node&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;frontmatter&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token function&quot;&gt;createPage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    path&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;slug&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n    component&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; path&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;templatePath&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;blogpost.js&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token function&quot;&gt;createLinkCards&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    title&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n    path&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; path&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;public&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;slug&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;-link-card.png&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;After running &lt;code class=&quot;language-text&quot;&gt;gatsby build&lt;/code&gt; the public folder will now have a link card file\nfor each post. Open one and check how it looks. Next step will be to link this\nin the blogpost template. These things needs to be linked in meta tags in the\nhead tag. To change metadata with Gatsby it is recommended to use react-helmet.\nThere is a [guide on how to change metadata][gatsby-docs-metadata] in the Gatsby\ndocumentation. In the component in the &lt;code class=&quot;language-text&quot;&gt;blogpost.js&lt;/code&gt; template add the following\nsnippet of code.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Helmet&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;\n  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;meta name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;twitter:title&quot;&lt;/span&gt; content&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;title&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;\n  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;meta name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;twitter:card&quot;&lt;/span&gt; content&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;summary_large_image&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;\n  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;meta name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;twitter:author&quot;&lt;/span&gt; content&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;@&amp;lt;your twitter handle&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;\n  &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;meta name&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;twitter:image:src&quot;&lt;/span&gt; content&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;window&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;location&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;origin&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;slug&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;-link-card.png&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;\n&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Helmet&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;This is all that is needed to get these nice cards in tweets with links to your blog.\nIt might be worth looking into more meta tags for getting the same behavior on other\nsites that have similar functionality. Remember that &lt;a href=&quot;https://cards-dev.twitter.com/validator&quot;&gt;twitter has a tool to test&lt;/a&gt;\nyour new cards.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Related articles with Gatsby]]></title><description><![CDATA[This website is created with Gatsby, Reasonml and a little bit of typescript.\nIn this post I will explain how I built the \"Related articles‚Ä¶]]></description><link>https://rolflekang.com/related-articles-with-gatsby</link><guid isPermaLink=\"false\">https://rolflekang.com/related-articles-with-gatsby</guid><category><![CDATA[gatsby]]></category><category><![CDATA[javascript]]></category><pubDate>Wed, 20 Feb 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;This website is created with &lt;a href=&quot;https://www.gatsbyjs.org/&quot;&gt;Gatsby&lt;/a&gt;, Reasonml and a little bit of typescript.\nIn this post I will explain how I built the &quot;Related articles&quot; feature that can be\nseen on the bottom of some of the articles. I have kept all the examples in this\npost in javascript so it will be helpful to more people.&lt;/p&gt;\n&lt;p&gt;First of we need to define what makes two posts or articles related. On this site\nand for this article I am defining it as articles that has the same tags. In the\nfrontmatter I have a comma separated list of tags. Below is an example:&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Related articles with Gatsby\n&lt;span class=&quot;token key atrule&quot;&gt;slug&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; related&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;articles&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;with&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;gatsby\n&lt;span class=&quot;token key atrule&quot;&gt;tags&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; gatsby&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;javascript\n&lt;span class=&quot;token key atrule&quot;&gt;date&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token datetime number&quot;&gt;2019-02-20&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;This blog is based on a setup with &lt;a href=&quot;https://www.gatsbyjs.org/packages/gatsby-transformer-remark/&quot;&gt;gatsby-transformer-remark&lt;/a&gt; which has the\nfollowing in &lt;code class=&quot;language-text&quot;&gt;gatsby-node.js&lt;/code&gt; to generate the pages. The first part fetches all\nthe articles and the necessary metadata with Graphql. The second part loops over\nall the articles and then creates pages for them with the Gatsby &lt;code class=&quot;language-text&quot;&gt;createPage&lt;/code&gt;\nfunction.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;exports&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;createPages&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; graphql&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; actions &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; createPage &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; actions&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; templatePath &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; path&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./src/templates/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n\n  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; response &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;graphql&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;\n    &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;\n      query {\n        allMarkdownRemark {\n          edges {\n            node {\n              frontmatter {\n                layout\n                slug\n                date(formatString: &quot;DD.MM.YYYY&quot;)\n              }\n            }\n          }\n        }\n      }\n    &lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n\n  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; postEdges &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;allMarkdownRemark&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;edges\n\n  postEdges&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; node &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; slug&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; layout&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; tags &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; node&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;frontmatter&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token function&quot;&gt;createPage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n      path&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;slug&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n      component&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; path&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;templatePath&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;layout&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;.tsx&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n      context&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; slug &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;In order to populate the data for related articles we will add the data as\ncontext parameters in the createPage call. However, first we need to find\nthose articles. The code below will build a map of tags and articles with those\ntags.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; articlesByTags &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; postEdges&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;reduce&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;lastValue&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; node &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; tags &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; node&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;frontmatter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;tags &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  tags&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token regex&quot;&gt;/, ?/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;lastValue&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;tag&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n      lastValue&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;tag&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;node&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;frontmatter&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n      lastValue&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;tag&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;node&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;frontmatter&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; lastValue&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;The result will be something like the following, where &lt;code class=&quot;language-text&quot;&gt;{...}&lt;/code&gt; is the\nfrontmatter of a post. This we can use to look up all the related articles for\none post.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n  gatsby&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n  cli&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;The &lt;code class=&quot;language-text&quot;&gt;articlesByTags&lt;/code&gt; is useful for looking up all the articles that has a list of tags. Let\nus look at a possible implementation for that.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; _ &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;lodash/fp&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n\n&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;findRelatedArticles&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;slug&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; tags&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; _&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;flow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;\n    _&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token regex&quot;&gt;/, ?/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n    _&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; articlesByTags&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;tag&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n    _&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;flatten&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n    _&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;node&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; node&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;slug &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; slug&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n    _&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uniqBy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;node&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; node&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;slug&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;tags&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;In this function the &lt;code class=&quot;language-text&quot;&gt;_&lt;/code&gt; is the\n&lt;a href=&quot;https://github.com/lodash/lodash/wiki/FP-Guide&quot;&gt;functional programming(fp) version of lodash&lt;/a&gt;, which has this neat\nutility called flow for grouping actions together. Flow returns a function when\ncalled will perform all the operations in the array. Each operation will have\nto be a function and the return value of each of them will be passed as the\nargument to the next one. The function above will first split the comma\nseparated string to a list and then perform a map on that list of tags to a\nlist of lists of articles. Since we now have a list of lists it is necessary to\nflatten it, which will result in a list of articles. The next step is to filter\nout the current post since we only want other articles than the one that is\ncurrently viewed. In the last step we want to remove any duplicate articles and\ncan do that by selecting unique elements based on the slug.&lt;/p&gt;\n&lt;p&gt;To finish the data setup it is necessary to add the related articles to the\ncontext in the &lt;code class=&quot;language-text&quot;&gt;createPage&lt;/code&gt; call.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token function&quot;&gt;createPage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n  path&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;slug&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n  component&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; path&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;templatePath&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;layout&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;.tsx&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n  context&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    slug&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;    relatedArticles&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;findRelatedArticles&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;slug&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; tags&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;/span&gt;  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;The &lt;code class=&quot;language-text&quot;&gt;gatsby-node.js&lt;/code&gt; file should look something like the following now. In the\ncode below the changes is highlighted.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;exports&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function-variable function&quot;&gt;createPages&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; graphql&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; actions &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; createPage &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; actions&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; templatePath &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; path&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;./src/templates/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n\n  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; response &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;graphql&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;\n    &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;\n      query {\n        allMarkdownRemark {\n          edges {\n            node {\n              frontmatter {\n                layout\n                slug\n                date(formatString: &quot;DD.MM.YYYY&quot;)\n              }\n            }\n          }\n        }\n      }\n    &lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n\n  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; postEdges &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;allMarkdownRemark&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;edges&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n\n&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; articlesByTags &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; postEdges&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;reduce&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;lastValue&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; node &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; tags &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; node&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;frontmatter&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;tags &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;    tags&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token regex&quot;&gt;/, ?/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;lastValue&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;tag&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;        lastValue&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;tag&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;push&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;node&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;frontmatter&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;        lastValue&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;tag&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;node&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;frontmatter&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; lastValue&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/span&gt;\n&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;  &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;findRelatedArticles&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;slug&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; tags&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; _&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;flow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;      _&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token regex&quot;&gt;/, ?/&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;      _&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;tag&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; articlesByTags&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;tag&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;      _&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;flatten&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;      _&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;filter&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;node&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; node&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;slug &lt;span class=&quot;token operator&quot;&gt;!==&lt;/span&gt; slug&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;      _&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;uniqBy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;node&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; node&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;slug&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;    &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;tags&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;\n  postEdges&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;forEach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; node &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; slug&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; layout&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; tags &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; node&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;frontmatter&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token function&quot;&gt;createPage&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n      path&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;slug&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n      component&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; path&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;templatePath&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;layout&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;.tsx&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n      context&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n        slug&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n&lt;span class=&quot;gatsby-highlight-code-line&quot;&gt;        relatedArticles&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;findRelatedArticles&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;slug&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; tags&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;/span&gt;      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;At this point all the data needed is in place. However, it still has to\nbe shown to give some value. Let us look at a component to add this to\nthe site.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;RelatedArticles&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;props&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;articles &lt;span class=&quot;token operator&quot;&gt;||&lt;/span&gt; props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;articles&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length &lt;span class=&quot;token operator&quot;&gt;===&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;div &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;\n    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;section id&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;related-articles&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;\n      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;header&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;Related articles&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;header&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;\n      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;ul&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;\n        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;articles&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;article&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;\n          &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;li key&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;article&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;slug&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;\n            &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;Link to&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;${&lt;/span&gt;article&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;slug&lt;span class=&quot;token interpolation-punctuation punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;article&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;title&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;Link&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;\n            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos; &apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n            &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;em&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;article&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;date&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;em&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;\n          &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;li&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;\n        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;ul&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;\n    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;section&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;This component will render an empty div if there are no related articles.\nIn the case of related articles it will render a list with links to the\narticles. Remember that the data available here is defined by the graphql\nquery in &lt;code class=&quot;language-text&quot;&gt;gatbsy-node.js&lt;/code&gt;. In order to glue these parts together and make\nit work the component needs to be added in the template used for the\narticles.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;RelatedArticles articles&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pageContext&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;relatedArticles&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;The page component will get the &lt;code class=&quot;language-text&quot;&gt;context&lt;/code&gt; attribute from &lt;code class=&quot;language-text&quot;&gt;createPage&lt;/code&gt; as\n&lt;code class=&quot;language-text&quot;&gt;pageContext&lt;/code&gt;. Thus, the &lt;code class=&quot;language-text&quot;&gt;relatedArticles&lt;/code&gt; attribute we created earlier will\nbe accessible on that object.&lt;/p&gt;\n&lt;p&gt;This is all that is needed to have related articles with a Gatsby site with\nthe transformer-remark plugin. To see have it looks have a look at the bottom\nof the &lt;a href=&quot;/testing-simple-graphql-services#related-articles&quot;&gt;Testing simple GraphQL services&lt;/a&gt;\narticle.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Creating a CLI with  Reason native]]></title><description><![CDATA[Recently I have started to look into the native compilation of Reason. There\nare many use cases for compiling to native, e.g. fast CLIs‚Ä¶]]></description><link>https://rolflekang.com/creating-a-cli-with-reason-native</link><guid isPermaLink=\"false\">https://rolflekang.com/creating-a-cli-with-reason-native</guid><category><![CDATA[reasonml]]></category><category><![CDATA[native]]></category><pubDate>Tue, 12 Feb 2019 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Recently I have started to look into the native compilation of Reason. There\nare many use cases for compiling to native, e.g. fast CLIs, react based ui\ndevelopment without a browser runtime like electron or using  Reason for the\nbackend of a project. I am writing this to gather some getting started info\nas I go and will try to keep things up to date as I learn more.&lt;/p&gt;\n&lt;p&gt;The goal of this blogpost is to create a simple CLI for basic calculation.\nNot the most useful CLI tool, but a small thing to get started. The post\nmight make more sense if you have a little bit prior knowledge about Reason.\nHowever, don&apos;t be afraid to try setting this up, but the post does not explain\nReason syntax. The &lt;a href=&quot;https://reasonml.github.io/&quot;&gt;reason documentation&lt;/a&gt; and the\n&lt;a href=&quot;https://egghead.io/courses/get-started-with-reason&quot;&gt;egghead.io course getting started with reason&lt;/a&gt; are good\nresources.&lt;/p&gt;\n&lt;p&gt;We are going to use a few different tools.&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=&quot;https://esy.sh/&quot;&gt;&lt;strong&gt;Esy&lt;/strong&gt;&lt;/a&gt; helps us manage dependencies and package our code based on\npackage.json.&lt;/li&gt;\n&lt;li&gt;&lt;a href=&quot;https://github.com/jordwalke/pesy&quot;&gt;&lt;strong&gt;Pesy&lt;/strong&gt;&lt;/a&gt; is a tool that has two useful features that we will leverage:\ncreating esy projects and configuring dune.&lt;/li&gt;\n&lt;li&gt;&lt;a href=&quot;https://dune.build/&quot;&gt;&lt;strong&gt;Dune&lt;/strong&gt;&lt;/a&gt; is a build system for ocaml and reason. It will take care\nof compiling and running our code in development.&lt;/li&gt;\n&lt;li&gt;&lt;a href=&quot;https://reason-native.com&quot;&gt;&lt;strong&gt;reason native&lt;/strong&gt;&lt;/a&gt; is a collection of libraries for creating natively compiled applications.&lt;/li&gt;\n&lt;/ul&gt;\n&lt;h2&gt;Setting up the project&lt;/h2&gt;\n&lt;p&gt;Firstly, we need to setup the project with some basic build tools.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; -g esy pesy\n&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; calc &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; calc\npesy&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;This will create a file structure like the list below. There will be more\nfiles, however, these are the most relevant ones. The folders &lt;code class=&quot;language-text&quot;&gt;executable&lt;/code&gt;,\n&lt;code class=&quot;language-text&quot;&gt;library&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;test&lt;/code&gt; are different source directories. &lt;code class=&quot;language-text&quot;&gt;dune-project&lt;/code&gt; and\n&lt;code class=&quot;language-text&quot;&gt;dune&lt;/code&gt; are config files for dune. Those are automatically maintained by pesy\nso we do not need to edit those manually. The &lt;code class=&quot;language-text&quot;&gt;calc.opam&lt;/code&gt; is the config\nfile for the ocaml package manager, kind of like package.json is for npm. At\nlast this project also have a package.json, which is used to specify\ndependencies for esy and the build configuration for pesy.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;executable/\nlibrary/\ntest/\ncalc.opam\ndune\ndune-project\npackage.json&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;If we look into the package.json it has some configuration for both esy\nand pesy:&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n  &lt;span class=&quot;token property&quot;&gt;&quot;esy&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;&quot;build&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;pesy&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;&quot;release&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n      &lt;span class=&quot;token property&quot;&gt;&quot;releasedBinaries&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;CalcApp.exe&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n  &lt;span class=&quot;token property&quot;&gt;&quot;buildDirs&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;&quot;test&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n      &lt;span class=&quot;token property&quot;&gt;&quot;require&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Calc.lib&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n      &lt;span class=&quot;token property&quot;&gt;&quot;main&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;TestCalc&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n      &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;TestCalc.exe&quot;&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;&quot;library&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n      &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Calc.lib&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n      &lt;span class=&quot;token property&quot;&gt;&quot;namespace&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Calc&quot;&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;&quot;executable&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n      &lt;span class=&quot;token property&quot;&gt;&quot;require&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Calc.lib&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n      &lt;span class=&quot;token property&quot;&gt;&quot;main&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;CalcApp&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n      &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;CalcApp.exe&quot;&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;The easy configuration needs to know how we build things and what we want to\nexport out of our package since it is handling packaging. Pesy is using the\n&lt;code class=&quot;language-text&quot;&gt;buildDirs&lt;/code&gt; setting for its config. Each directory that we are using in for\ncode in the project needs to have a set of settings. Mainly name and\ndependencies,\n&lt;a href=&quot;https://github.com/jordwalke/pesy#supported-config&quot;&gt;full list of supported config can be found in the pesy readme&lt;/a&gt;.\nThe &lt;code class=&quot;language-text&quot;&gt;buildDirs&lt;/code&gt; config in packages.json is the baseline for the config written\ninto dune files. Thus, every time we update the &lt;code class=&quot;language-text&quot;&gt;buildDirs&lt;/code&gt; config we need to run\n&lt;code class=&quot;language-text&quot;&gt;esy pesy&lt;/code&gt; to update the dune config files. Dune is the tool building the project and\nrunning the ocaml compiler. We run that with &lt;code class=&quot;language-text&quot;&gt;esy build&lt;/code&gt; and after building the project\nwe can run the executable with &lt;code class=&quot;language-text&quot;&gt;esy x CalcApp.exe&lt;/code&gt;.&lt;/p&gt;\n&lt;p&gt;In order to build a release binary of the CLI we can run &lt;code class=&quot;language-text&quot;&gt;esy npm-release&lt;/code&gt;, which will\ncreate a folder &lt;code class=&quot;language-text&quot;&gt;_release&lt;/code&gt;. It will contain a bin folder with binary and a package.json\nfor npm publishing and a postinstall script provided by pesy. In order to publish to npm\nrun &lt;code class=&quot;language-text&quot;&gt;esy npm-release&lt;/code&gt; and then &lt;code class=&quot;language-text&quot;&gt;npm publish&lt;/code&gt; from the _release folder.&lt;/p&gt;\n&lt;h2&gt;Implementing the CLI&lt;/h2&gt;\n&lt;p&gt;Now that the project build tools are set up and configured we are ready to\nstart the implmentation. Firstly, we need to add some dependencies by running.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;esy add @reason-native/pastel @opam/cmdliner&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;This will install &lt;a href=&quot;https://reason-native.com/docs/pastel/&quot;&gt;reason native pastel&lt;/a&gt; from npm and &lt;a href=&quot;https://erratique.ch/software/cmdliner/doc/Cmdliner#basics&quot;&gt;cmdliner&lt;/a&gt; from opam, the\nocaml package manager. Pastel is helpful changing the font-style and colors on the\nterminal output. Cmdliner is a tool to parse command line arguments and generate\ndocumentation for command line tools. Furthermore, we need to add these to the libs\nsections of the executable package in the &lt;code class=&quot;language-text&quot;&gt;buildDirs&lt;/code&gt; config. The result should be:&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token property&quot;&gt;&quot;executable&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n  &lt;span class=&quot;token property&quot;&gt;&quot;require&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;cmdliner&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;pastel.lib&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;calc.lib&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n  &lt;span class=&quot;token property&quot;&gt;&quot;main&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;CalcApp&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n  &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;CalcApp.exe&quot;&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;The first thing we will add is a default command and run eval with cmdliner. This\ncode should be in &lt;code class=&quot;language-text&quot;&gt;./executable/CalcApp.re&lt;/code&gt;. The\nfollowing code will make the default command list the help screen generated by\ncmdliner.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;reason&quot;&gt;&lt;pre class=&quot;language-reason&quot;&gt;&lt;code class=&quot;language-reason&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;open&lt;/span&gt; &lt;span class=&quot;token constructor variable&quot;&gt;Cmdliner&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; version &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;1.0.0&quot;&lt;/span&gt;\n\n&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; default &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;\n  &lt;span class=&quot;token class-name&quot;&gt;Term&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ret&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;const&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;_ &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token constructor variable&quot;&gt;Help&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token constructor variable&quot;&gt;Pager&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constructor variable&quot;&gt;None&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; $ const&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n  &lt;span class=&quot;token class-name&quot;&gt;Term&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;info&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;calc&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;version&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n\n&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; _ &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Term&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eval_choice&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;default&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&gt;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Term&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;exit&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;The empty list in &lt;code class=&quot;language-text&quot;&gt;eval_choice&lt;/code&gt; is where the sub commands should be added.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;reason&quot;&gt;&lt;pre class=&quot;language-reason&quot;&gt;&lt;code class=&quot;language-reason&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; add &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Arg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value &amp;amp; pos&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; int&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &amp;amp; info&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;docv&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;number&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;doc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;First number&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; y &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Arg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value &amp;amp; pos&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; int&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &amp;amp; info&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;docv&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;number&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;doc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Second number&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;\n    &lt;span class=&quot;token class-name&quot;&gt;Term&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;const&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; print_result&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; y&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; $ x $ y&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n    &lt;span class=&quot;token class-name&quot;&gt;Term&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;info&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;add&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;version&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;In this part we define a new command &lt;code class=&quot;language-text&quot;&gt;add&lt;/code&gt; which takes two positional\narguments. Two numbers that we will add together. Let us break down the\ndifferent parts of the argument definition. In\n&lt;code class=&quot;language-text&quot;&gt;Arg.(value &amp;amp; pos(0, int, 0) &amp;amp; info([], ~docv=&amp;quot;number&amp;quot;, ~doc=&amp;quot;First number&amp;quot;))&lt;/code&gt;\nthere is three main parts. &lt;code class=&quot;language-text&quot;&gt;value&lt;/code&gt; tells that we want to extract the value, not\njust whether it is there(&lt;code class=&quot;language-text&quot;&gt;flag&lt;/code&gt;). &lt;code class=&quot;language-text&quot;&gt;pos(0, int, 0)&lt;/code&gt; is to instruct that this is\nthe positional argument at position 0 parsed as an integer with 0 as the default\nvalue. &lt;code class=&quot;language-text&quot;&gt;info([], ~docv=&amp;quot;number&amp;quot;, ~doc=&amp;quot;First number&amp;quot;))&lt;/code&gt; is to generate the\ndocumentation about the option. The empty list would contain the name if this was\nan option, &lt;code class=&quot;language-text&quot;&gt;docv&lt;/code&gt; is for the usage string while &lt;code class=&quot;language-text&quot;&gt;doc&lt;/code&gt; is for the man page.&lt;/p&gt;\n&lt;p&gt;Furthermore, in the creation of the command we have the statement.\n&lt;code class=&quot;language-text&quot;&gt;Term.(const((x, y) =&amp;gt; print_result(x + y)) $ x $ y)&lt;/code&gt; which\ndefines that the command should run the function\n&lt;code class=&quot;language-text&quot;&gt;(x, y) =&amp;gt; print_result(x + y)&lt;/code&gt; when called. It knows about\nthe arguments from the &lt;code class=&quot;language-text&quot;&gt;$ x $ y&lt;/code&gt; which applies the argument definition to\nthe command. If you try to remove &lt;code class=&quot;language-text&quot;&gt;$ y&lt;/code&gt; you will get a compile error\ncomplaining that at some place &lt;code class=&quot;language-text&quot;&gt;unit&lt;/code&gt; was expected but &lt;code class=&quot;language-text&quot;&gt;int =&amp;gt; unit&lt;/code&gt; was\nreceived. That is because the function in the command takes in both &lt;code class=&quot;language-text&quot;&gt;x&lt;/code&gt;\nand &lt;code class=&quot;language-text&quot;&gt;y&lt;/code&gt;, but only the argument definition for &lt;code class=&quot;language-text&quot;&gt;x&lt;/code&gt; is applied.&lt;/p&gt;\n&lt;p&gt;In the command above we have used a function &lt;code class=&quot;language-text&quot;&gt;print_result&lt;/code&gt; that does\nnot exist. This is a nice use case for &lt;a href=&quot;https://reason-native.com/docs/pastel/&quot;&gt;pastel&lt;/a&gt;, which\nis a library to handle styling of printed text in the terminal. Below is\nan implementation of the &lt;code class=&quot;language-text&quot;&gt;print_result&lt;/code&gt; function.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;reason&quot;&gt;&lt;pre class=&quot;language-reason&quot;&gt;&lt;code class=&quot;language-reason&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; print_result &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; result &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt;\n  &lt;span class=&quot;token class-name&quot;&gt;Pastel&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;\n    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constructor variable&quot;&gt;Pastel&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;\n      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constructor variable&quot;&gt;Pastel&lt;/span&gt; color&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token constructor variable&quot;&gt;BlackBright&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Result: &quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token constructor variable&quot;&gt;Pastel&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;\n      &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token constructor variable&quot;&gt;Pastel&lt;/span&gt; bold&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;string_of_int&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;result&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token constructor variable&quot;&gt;Pastel&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;\n    &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token constructor variable&quot;&gt;Pastel&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n  &lt;span class=&quot;token operator&quot;&gt;|&gt;&lt;/span&gt; print_endline&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;It will first create a string with the correct formatting, in other words the\n&lt;code class=&quot;language-text&quot;&gt;&amp;lt;Pastel&amp;gt;&amp;lt;/Pastel&amp;gt;&lt;/code&gt; evaluates to a string. The string is then passed along to\n&lt;code class=&quot;language-text&quot;&gt;print_endline&lt;/code&gt; from ocaml.&lt;/p&gt;\n&lt;p&gt;In order to use the add command, it has to be added to the command list so\nchange the &lt;code class=&quot;language-text&quot;&gt;eval_choice&lt;/code&gt; line to:&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;reason&quot;&gt;&lt;pre class=&quot;language-reason&quot;&gt;&lt;code class=&quot;language-reason&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; _ &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Term&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;eval_choice&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;default&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;add&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&gt;&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Term&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;exit&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;In the code above the addition implementation is within the task, for a simple\nCLI one might argue that it is fine. However, if it was more than a one line it\nprobably should be moved out. A nice side effect of moving it is that it becomes\neasier to test. In the &lt;code class=&quot;language-text&quot;&gt;buildDirs&lt;/code&gt; config in package.json there is this library\nfolder, which is a dependency of the executable part. Create a &lt;code class=&quot;language-text&quot;&gt;Calculator.re&lt;/code&gt;\nin that folder.&lt;/p&gt;\n&lt;p&gt;In &lt;code class=&quot;language-text&quot;&gt;Calculator.re&lt;/code&gt; will contain the calculation logic. In this example this will\nbe a small module only to demonstrate the relation between library and executable\nfolder in the default pesy layout. Add the following function to the `Calculator.re&lt;code class=&quot;language-text&quot;&gt;&lt;/code&gt;\nfile:&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;reason&quot;&gt;&lt;pre class=&quot;language-reason&quot;&gt;&lt;code class=&quot;language-reason&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; add &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; y&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;It is possible to use library modules inside the executable folder by referring\nto the namespace in the package.json config for the library, that was named\n&lt;code class=&quot;language-text&quot;&gt;Calc&lt;/code&gt;. If we want to use the add function we added we can use &lt;code class=&quot;language-text&quot;&gt;Calc.Calculator.add&lt;/code&gt;\nor do &lt;code class=&quot;language-text&quot;&gt;open Calc&lt;/code&gt; and then &lt;code class=&quot;language-text&quot;&gt;Calculator.add&lt;/code&gt;. This means that the task definition can\nbe changed to the following:&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;reason&quot;&gt;&lt;pre class=&quot;language-reason&quot;&gt;&lt;code class=&quot;language-reason&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;open&lt;/span&gt; &lt;span class=&quot;token constructor variable&quot;&gt;Calc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; add &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; x &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Arg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value &amp;amp; pos&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; int&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &amp;amp; info&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;docv&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;number&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;doc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;First number&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; y &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Arg&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value &amp;amp; pos&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; int&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &amp;amp; info&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;docv&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;number&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;doc&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Second number&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;\n    &lt;span class=&quot;token class-name&quot;&gt;Term&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;const&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; print_result&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Calculator&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;add&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; $ x $ y&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n    &lt;span class=&quot;token class-name&quot;&gt;Term&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;info&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;add&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;version&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;Try to run &lt;code class=&quot;language-text&quot;&gt;esy x CalcApp.exe add 2 3&lt;/code&gt; it should print the result and it should\nbe something like the output below. üéâ&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;Result: &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;Congratulations on making a CLI with Reason. Next steps might be to look at &lt;a href=&quot;https://reason-native.com/docs/rely/&quot;&gt;rely&lt;/a&gt;\nto create some tests for the library code. I have made a companion repository\nfor this post on &lt;a href=&quot;https://github.com/relekang/reason-calculator&quot;&gt;github.com/relekang/reason-calculator&lt;/a&gt; if you get stuck on\nsomething you can have a look there or if you just want to have a look at the code.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Testing simple GraphQL services]]></title><description><![CDATA[I recently created a GraphQL based microservice for parsing RSS-feeds. I wanted\nto write something down about the approach I took to test‚Ä¶]]></description><link>https://rolflekang.com/testing-simple-graphql-services</link><guid isPermaLink=\"false\">https://rolflekang.com/testing-simple-graphql-services</guid><category><![CDATA[graphql]]></category><category><![CDATA[testing]]></category><category><![CDATA[javascript]]></category><pubDate>Sun, 28 May 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I recently created a &lt;a href=&quot;https://github.com/relekang/micro-rss-parser&quot;&gt;GraphQL based microservice&lt;/a&gt; for parsing RSS-feeds. I wanted\nto write something down about the approach I took to test the API. The service is read only, as\nthere is little we can push out into others RSS feeds.&lt;/p&gt;\n&lt;p&gt;GraphQL returns 200 status for almost everything. Whenever error occurs it only pushes the error\nto a list of errors that is passed to the payload. This is because it is designed to be resillient\nand give as much information as it can even when something fails. This also means that we can\nabstract away the most part of successful and unsuccessful requests in our tests and still get\nvalid tests. Thus, when testing the API layer of this service the only thing that matters is the\nquery and the response.&lt;/p&gt;\n&lt;p&gt;Services like micro-rss-parser has another characteristic that makes them easy to test. No\nauthentication or authorization, which means that we do not need to check different types of errors\nbased on different states of authorization. Thus, it is only the GraphQL query and the response\nthat matters.&lt;/p&gt;\n&lt;p&gt;I created a helper that allowed me to write tests in an easy way with focus on the queries. The\ntests look like this:&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;testGraphQlService&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;{\n  feed(url=&quot;https://rolflekang.com/feed.xml&quot;) {\n    entries {\n      title\n    }\n  }\n}\n &lt;/span&gt;&lt;span class=&quot;token template-punctuation string&quot;&gt;`&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;Under the hood that helper creates a &lt;a href=&quot;https://facebook.github.io/jest/&quot;&gt;jest&lt;/a&gt; test that asserts to a snapshot with jests handy\n&lt;a href=&quot;http://facebook.github.io/jest/docs/expect.html#tomatchsnapshotoptionalstring&quot;&gt;toMatchSnapshot()&lt;/a&gt;. This generates a snapshot file for every test file with a map of responses\nwith the query as key. Thus, reviewing these tests and test changes is a bliss. Below is the\nimplementation of the test helper as it was in micro-rss-parser at the time when this was written.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;js&quot;&gt;&lt;pre class=&quot;language-js&quot;&gt;&lt;code class=&quot;language-js&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; request &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;superagent&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n\n&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createTestServer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n  &lt;span class=&quot;token comment&quot;&gt;/*\n   * Set up a test instance and return url.\n   * For micro-rss-parser I used this https://github.com/zeit/micro#testing\n   */&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n\n&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;testGraphqlApi&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;strings&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;args&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n  &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; query &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; String&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;raw&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;strings&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;...&lt;/span&gt;args&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n  &lt;span class=&quot;token function&quot;&gt;test&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; response\n    &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; url &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;createTestServer&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n\n    &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n      response &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;await&lt;/span&gt; request\n        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;post&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;User-Agent&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;graphql-test&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;set&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Content-Type&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;application/json&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n        &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;JSON&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;stringify&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; query &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n      &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;body\n    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n        &lt;span class=&quot;token keyword&quot;&gt;throw&lt;/span&gt; error\n      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n\n      response &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; error&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;body\n    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n\n    &lt;span class=&quot;token function&quot;&gt;expect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;response&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;toMatchSnapshot&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;It has made it easy to write good and readable API tests of the little microservice. However,\nkeep in mind that this is a sufficient solution due to the assumptions discussed earlier so it\nmight not be a fit approach for you project, nevertheless, feel free to take the helper. Let me\nknow how it works out for you ‚úåÔ∏è&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Let's run some races this year]]></title><description><![CDATA[This will be the first year that I enter a running race, ever.\nI am pretty excited. I am at the moment aiming at three races\nfor this year‚Ä¶]]></description><link>https://rolflekang.com/lets-run-some-races</link><guid isPermaLink=\"false\">https://rolflekang.com/lets-run-some-races</guid><category><![CDATA[running]]></category><pubDate>Mon, 02 Jan 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;This will be the first year that I enter a running race, ever.\nI am pretty excited. I am at the moment aiming at three races\nfor this year.&lt;/p&gt;\n&lt;ul&gt;\n&lt;li&gt;Birkebeinerl√∏pet (21km)&lt;/li&gt;\n&lt;li&gt;Oslo Half-marathon&lt;/li&gt;\n&lt;li&gt;Nordmarka Ultra-Challenge (26 or 54km)&lt;/li&gt;\n&lt;/ul&gt;\n&lt;p&gt;The last one is still a maybe depending on how the two others\ngo. It is not a question of whether I am going to race, but whether\nI am going for 54km or the shorter distance.&lt;/p&gt;\n&lt;p&gt;See you on the trails üèÉ&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Software development on an iPad]]></title><description><![CDATA[I recently bought an iPad Pro as a replacement for my computer at home. The old one was a\nMacbook Pro that is taking its last spins these‚Ä¶]]></description><link>https://rolflekang.com/software-development-on-an-ipad</link><guid isPermaLink=\"false\">https://rolflekang.com/software-development-on-an-ipad</guid><category><![CDATA[ipad]]></category><category><![CDATA[development-environment]]></category><pubDate>Sun, 01 Jan 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I recently bought an iPad Pro as a replacement for my computer at home. The old one was a\nMacbook Pro that is taking its last spins these days. I wanted a device that was more of\na creative tool and also one that I could use to read things from &lt;a href=&quot;https://getpocket.com&quot;&gt;pocket&lt;/a&gt; and such.\nThus I landed on an iPad. It gets also used a bit for reading with the Kindle app.&lt;/p&gt;\n&lt;p&gt;The tools I use when I do development on the iPad is mostly &lt;a href=&quot;https://blink.sh&quot;&gt;Blink&lt;/a&gt; and &lt;a href=&quot;http://ergowebtools.com&quot;&gt;Ergo WebTools&lt;/a&gt;.\nBlink is simply the best ssh client for a tablet/mobile operative system that I have used. I\nam pretty sure I have tested most of the other ones the last few years. Ergo WebTools is neat\nsince Safari requires a Mac to be able to view the developer tools.&lt;/p&gt;\n&lt;p&gt;You might have guessed that I do development through a server, since Blink is a ssh and mosh\nclient. I use mosh to connect which smoothes out flakey connections and lost packages.\nOn the server I write code, and blogposts like this one with &lt;a href=&quot;https://vim.org&quot;&gt;vim&lt;/a&gt;. I use for this since\nit is my editor of choice for most things these days. There are many great options for\neditors. Web based IDE might be a nice option. Furthermore, I have found &lt;a href=&quot;https://tmux.github.io&quot;&gt;tmux&lt;/a&gt; to be\nvery helpful while running development servers and tests besides the &lt;a href=&quot;https://vim.org&quot;&gt;vim&lt;/a&gt; editor.&lt;/p&gt;\n&lt;p&gt;The server is a Ubuntu 16.10 which makes it able to run all I want to run on it\nwithout much hassle. Since a good part of what I use it for is web development\nI have created a nginx proxy that proxies &lt;code class=&quot;language-text&quot;&gt;&amp;lt;port&amp;gt;.dev.a.domain&lt;/code&gt; to &lt;code class=&quot;language-text&quot;&gt;127.0.0.1:&amp;lt;port&amp;gt;&lt;/code&gt;.\nIt works well, and adding a basic auth password on the redirect makes it a bit\nmore safe to expose all ports through ngnix. The code below is pretty much what\nruns that proxy. Webpack with hot reloading requires websockets, but that is\nstraight forward to set up if one follows the documentation.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;nginx&quot;&gt;&lt;pre class=&quot;language-nginx&quot;&gt;&lt;code class=&quot;language-nginx&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;listen&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;server_name&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;sub&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;^&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\\&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dev\\&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;example\\&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;com&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n\n    &lt;span class=&quot;token keyword&quot;&gt;access_log&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;var&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;log&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;nginx&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;dev&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;access&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;log&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;error_log&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;var&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;log&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;nginx&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;dev&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;error&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;log&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n\n    &lt;span class=&quot;token keyword&quot;&gt;location&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n        &lt;span class=&quot;token keyword&quot;&gt;proxy_pass&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;http&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;.0&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$sub&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n        &lt;span class=&quot;token keyword&quot;&gt;proxy_set_header&lt;/span&gt; Host &lt;span class=&quot;token variable&quot;&gt;$host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n        &lt;span class=&quot;token keyword&quot;&gt;proxy_set_header&lt;/span&gt; X&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;Real&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;IP &lt;span class=&quot;token variable&quot;&gt;$remote_addr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n        &lt;span class=&quot;token keyword&quot;&gt;proxy_set_header&lt;/span&gt; X&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;Forwarded&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;For &lt;span class=&quot;token variable&quot;&gt;$proxy_add_x_forwarded_for&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n        &lt;span class=&quot;token keyword&quot;&gt;client_max_body_size&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;m&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n\n        &lt;span class=&quot;token keyword&quot;&gt;auth_basic&lt;/span&gt;           &lt;span class=&quot;token string&quot;&gt;&quot;closed site&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n        &lt;span class=&quot;token keyword&quot;&gt;auth_basic_user_file&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;etc&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;nginx&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;htpasswd&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;Developing server side applications or libraries does not require much tools\nin addition to the ones that are available from the command line. Web\napplications and frontend things on the other hand. Web developer tools are\nnecessary or at least a real time saver. Safari requires a laptop to use the\ndeveloper tools which is not very helpful when trying to create a ipad only\nsetup. &lt;a href=&quot;http://ergowebtools.com&quot;&gt;Ergo WebTools&lt;/a&gt; is an app that implements developer tools around a\nSafari web view. I have not used it that much yet. However, it seems to be\nokay and useful even though it is far from what we are used to from modern\nbrowsers these days.&lt;/p&gt;\n&lt;p&gt;All in all it works well and is a nice change of scenery from time to time.\nIt is definitively a nicer option to bring to cafes and such.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Filtering lint errors]]></title><description><![CDATA[We all learn new stuff every day, that goes for how we write code as well.\nOver time our perception of best practices change, the codestyle‚Ä¶]]></description><link>https://rolflekang.com/filtering-lint-errors</link><guid isPermaLink=\"false\">https://rolflekang.com/filtering-lint-errors</guid><category><![CDATA[linter]]></category><category><![CDATA[linting]]></category><category><![CDATA[development]]></category><pubDate>Fri, 10 Jun 2016 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;We all learn new stuff every day, that goes for how we write code as well.\nOver time our perception of best practices change, the codestyle we prefer\nchange and what we would like to enforce with linters change.&lt;/p&gt;\n&lt;p&gt;Changing a linter configuration can be hard. The changes necessary\nto use the new configuration could be huge. You learned a new thing\nor a new lint rule finally got accepted and you want to start using the\nrule. When you add it to your project you are met with a result like the\none below. This means that a significant amount of time must be\nallocated to refactoring the code to follow the rule upfront.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt; ‚úñ 980 problems (976 errors, 4 warnings)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;In a few of the projects I participate in we have started to use information\nfrom git to filter out the lint errors that does not apply to the current\nchangeset. Resulting in the linter output above changing into the one\nlisted below.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;0 of 976 errors and 0 of 4 warnings&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;This has allowed us to change the our code guidelines without having to fix it\nright away. The impact has been great, as we have had the chance to alter our\nguidelines and make sure we do not write more code that does not follow the guidelines.&lt;/p&gt;\n&lt;p&gt;We made a tool, lint-filter, that will filter a checkstyle based lint report with the\ninformation in the git diff between the current state and the master branch. The way\nit works is that it will check that the lines referenced from the errors and warnings\nare in the git diff. Below is an example of how to use it with eslint.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm install -g lint-filter\neslint . -f checkstyle | lint-filter&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;This will work for most errors. However, there is a few errors that would be triggered\noutside the changeset. One example is unused variables. In most cases it will not be\ncached by if you remove the last usage of a variable. To avoid these kinds of false\nnegatives I recommend running another lint config as well. One were the extra rules\nare disabled. lint-filter will help you generate the configuration by running the\nfollowing command.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;lint-filter generate-config --linter eslint&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;Hope this helps you. Happy linting ‚òï&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Interrail summer]]></title><description><![CDATA[After I finished my master thesis in June I left for a interrail with my girlfriend this summer. Traveling by train has its ups an downs‚Ä¶]]></description><link>https://rolflekang.com/interrail-summer</link><guid isPermaLink=\"false\">https://rolflekang.com/interrail-summer</guid><category><![CDATA[travel]]></category><category><![CDATA[interrail]]></category><pubDate>Sun, 26 Jul 2015 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;After I finished my master thesis in June I left for a interrail with my girlfriend this summer. Traveling by train has its ups an downs, but overall it was a great experience that I hope to do it again soon. Although we were interrailing we did not by a interrail pass as our research indicated that it would be cheaper without it. In the end we ended up paying half the price we would have payed with interrail tickets.&lt;/p&gt;\n&lt;p&gt;If you are wondering if you should travel Europe by train then &lt;em&gt;do it&lt;/em&gt;.&lt;/p&gt;\n&lt;h2&gt;The trains&lt;/h2&gt;\n&lt;p&gt;We started out in Berlin arriving from Norway by airplane. Further on, we took the train to Prague. The train ride was hot as the air condition was broken and a blazing sun with 35 degrees roamed outside. Onwards from Prague we left for Vienna, which was a pleasant ride with the new Railjet trains. The next ride was a short 1 hour ride to Bratislava, not much more to say about that. From there we left for Budapest on a nice and short train ride. The next trip was the longest from Budapest to Zagreb. It got even longer when the train stopped after an hour or so and the someone from the Hungarian Railway said &quot;End station. Get off!&quot;. We got off to see a line of buses, which took us to the next station where a new train was waiting. There was no problem, rather an interesting experience as we traveled small local roads between a couple of train stations without any information about what was happening. After two nights in Zagreb we took a train to Ljubljana. The train ride was incredibly scenic. If you have the chance to take it you should do it. At last but not at least, we went to Rijeka with another train without air condition. However, this was not nearly as hot as the first one.&lt;/p&gt;\n&lt;p&gt;In my opinion, the train rides ranging from 2,5 to 4 hours were the best. Enough time to read and watch the countryside while listening to a podcast or an audio book. However, not to long to get tired an longing for the destination. All in all, the trips with trains was great and a nice way to visit and see so many different places and cultures. One of the good parts is that you break up the exploring days with some days with a lot of reading and podcast listening.&lt;/p&gt;\n&lt;h2&gt;A few highlights&lt;/h2&gt;\n&lt;h4&gt;The burger from &lt;em&gt;The pub&lt;/em&gt; in Berlin&lt;/h4&gt;\n&lt;p&gt;Not much more to say than it&apos;s delicious.&lt;/p&gt;\n&lt;h4&gt;The architecture of Vienna&lt;/h4&gt;\n&lt;p&gt;&lt;span\n      class=&quot;gatsby-resp-image-wrapper&quot;\n      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 750px;&quot;\n    &gt;\n      &lt;a\n    class=&quot;gatsby-resp-image-link&quot;\n    href=&quot;/static/a6efd0729609dda243a7e9e68d1a04f5/3acf0/vienna.jpg&quot;\n    style=&quot;display: block&quot;\n    target=&quot;_blank&quot;\n    rel=&quot;noopener&quot;\n  &gt;\n    &lt;span\n    class=&quot;gatsby-resp-image-background-image&quot;\n    style=&quot;padding-bottom: 37.23404255319149%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAHABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAID/8QAFQEBAQAAAAAAAAAAAAAAAAAAAQL/2gAMAwEAAhADEAAAAZgl0Cf/xAAYEAADAQEAAAAAAAAAAAAAAAAAAQIRE//aAAgBAQABBQLZHSO2H//EABYRAAMAAAAAAAAAAAAAAAAAAAABEf/aAAgBAwEBPwGIiP/EABYRAAMAAAAAAAAAAAAAAAAAAAABEf/aAAgBAgEBPwGsrP/EABcQAAMBAAAAAAAAAAAAAAAAAAABITL/2gAIAQEABj8CqIjJ/8QAGRABAAMBAQAAAAAAAAAAAAAAAQAhkUFh/9oACAEBAAE/ITq7AVd7BUDs/9oADAMBAAIAAwAAABAIL//EABYRAAMAAAAAAAAAAAAAAAAAAAEQUf/aAAgBAwEBPxAyV//EABcRAQADAAAAAAAAAAAAAAAAAAABUWH/2gAIAQIBAT8Qi9s//8QAGxABAAICAwAAAAAAAAAAAAAAAQARITFBYdH/2gAIAQEAAT8QcaVbIWwg56QyxOLfk//Z&apos;); background-size: cover; display: block;&quot;\n  &gt;&lt;/span&gt;\n  &lt;img\n        class=&quot;gatsby-resp-image-image&quot;\n        alt=&quot;... in Vienna&quot;\n        title=&quot;... in Vienna&quot;\n        src=&quot;/static/a6efd0729609dda243a7e9e68d1a04f5/acb04/vienna.jpg&quot;\n        srcset=&quot;/static/a6efd0729609dda243a7e9e68d1a04f5/bc01b/vienna.jpg 188w,\n/static/a6efd0729609dda243a7e9e68d1a04f5/bf173/vienna.jpg 375w,\n/static/a6efd0729609dda243a7e9e68d1a04f5/acb04/vienna.jpg 750w,\n/static/a6efd0729609dda243a7e9e68d1a04f5/ec605/vienna.jpg 1125w,\n/static/a6efd0729609dda243a7e9e68d1a04f5/c58a3/vienna.jpg 1500w,\n/static/a6efd0729609dda243a7e9e68d1a04f5/3acf0/vienna.jpg 2000w&quot;\n        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;\n        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;\n        loading=&quot;lazy&quot;\n      /&gt;\n  &lt;/a&gt;\n    &lt;/span&gt;&lt;/p&gt;\n&lt;h4&gt;Old town in Bratislava&lt;/h4&gt;\n&lt;p&gt;It was nice to walk around and drinking coffee at a local coffee shop.&lt;/p&gt;\n&lt;h4&gt;Boat Hotel in Budapest&lt;/h4&gt;\n&lt;p&gt;&lt;span\n      class=&quot;gatsby-resp-image-wrapper&quot;\n      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 750px;&quot;\n    &gt;\n      &lt;a\n    class=&quot;gatsby-resp-image-link&quot;\n    href=&quot;/static/e57fb4c3485878d0956979540e7fabcc/b17f8/boat-hotel.jpg&quot;\n    style=&quot;display: block&quot;\n    target=&quot;_blank&quot;\n    rel=&quot;noopener&quot;\n  &gt;\n    &lt;span\n    class=&quot;gatsby-resp-image-background-image&quot;\n    style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAECA//EABYBAQEBAAAAAAAAAAAAAAAAAAIAAf/aAAwDAQACEAMQAAABzc2gwLf/xAAZEAACAwEAAAAAAAAAAAAAAAAAAQIREhP/2gAIAQEAAQUCpMwYIpyHCjmf/8QAFREBAQAAAAAAAAAAAAAAAAAAABL/2gAIAQMBAT8BhD//xAAVEQEBAAAAAAAAAAAAAAAAAAAAE//aAAgBAgEBPwGir//EABcQAAMBAAAAAAAAAAAAAAAAAAAQIQH/2gAIAQEABj8CcLq//8QAGxAAAgIDAQAAAAAAAAAAAAAAAAERUSFBkXH/2gAIAQEAAT8hS0p9RC0RtdMXp4Y800mJ40j/2gAMAwEAAgADAAAAENwv/8QAFhEBAQEAAAAAAAAAAAAAAAAAACFx/9oACAEDAQE/EKaf/8QAGBEAAgMAAAAAAAAAAAAAAAAAAAERMVH/2gAIAQIBAT8QbqyWH//EABwQAQACAgMBAAAAAAAAAAAAAAEAESFhUYGhwf/aAAgBAQABPxDBjpBg5ZUbhR80Uy9MO0uYpS41m0qVlB8Lfs//2Q==&apos;); background-size: cover; display: block;&quot;\n  &gt;&lt;/span&gt;\n  &lt;img\n        class=&quot;gatsby-resp-image-image&quot;\n        alt=&quot;The boat we stayed on in Budapest&quot;\n        title=&quot;The boat we stayed on in Budapest&quot;\n        src=&quot;/static/e57fb4c3485878d0956979540e7fabcc/acb04/boat-hotel.jpg&quot;\n        srcset=&quot;/static/e57fb4c3485878d0956979540e7fabcc/bc01b/boat-hotel.jpg 188w,\n/static/e57fb4c3485878d0956979540e7fabcc/bf173/boat-hotel.jpg 375w,\n/static/e57fb4c3485878d0956979540e7fabcc/acb04/boat-hotel.jpg 750w,\n/static/e57fb4c3485878d0956979540e7fabcc/ec605/boat-hotel.jpg 1125w,\n/static/e57fb4c3485878d0956979540e7fabcc/c58a3/boat-hotel.jpg 1500w,\n/static/e57fb4c3485878d0956979540e7fabcc/b17f8/boat-hotel.jpg 1600w&quot;\n        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;\n        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;\n        loading=&quot;lazy&quot;\n      /&gt;\n  &lt;/a&gt;\n    &lt;/span&gt;&lt;/p&gt;\n&lt;h4&gt;Coffee at &lt;em&gt;Johann Franck&lt;/em&gt; in Zagreb&lt;/h4&gt;\n&lt;p&gt;The atmosphere and view of the main square was nice company to some good coffee and delicious fresh orange juice.&lt;/p&gt;\n&lt;h4&gt;The trainride from Zagreb to Ljubljana&lt;/h4&gt;\n&lt;p&gt;This trainride had an epic scenery that none of the other train rides.&lt;/p&gt;\n&lt;p&gt;&lt;span\n      class=&quot;gatsby-resp-image-wrapper&quot;\n      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 750px;&quot;\n    &gt;\n      &lt;a\n    class=&quot;gatsby-resp-image-link&quot;\n    href=&quot;/static/a9833eff2148367b26515e378a113aaf/b17f8/train-view.jpg&quot;\n    style=&quot;display: block&quot;\n    target=&quot;_blank&quot;\n    rel=&quot;noopener&quot;\n  &gt;\n    &lt;span\n    class=&quot;gatsby-resp-image-background-image&quot;\n    style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAID/8QAFgEBAQEAAAAAAAAAAAAAAAAAAQID/9oADAMBAAIQAxAAAAFGk41skn//xAAcEAABAwUAAAAAAAAAAAAAAAAAAQITAwQREjH/2gAIAQEAAQUC6bVWiXLsRkSEaH//xAAWEQEBAQAAAAAAAAAAAAAAAAAAERL/2gAIAQMBAT8BjL//xAAWEQEBAQAAAAAAAAAAAAAAAAAAERP/2gAIAQIBAT8BrR//xAAbEAACAQUAAAAAAAAAAAAAAAAAASECESAisf/aAAgBAQAGPwLXpF0TSnh//8QAGhABAQEAAwEAAAAAAAAAAAAAAQARQVFxkf/aAAgBAQABPyHeDYRRxudjbR1LNFb0+3//2gAMAwEAAgADAAAAEHAP/8QAFxEBAQEBAAAAAAAAAAAAAAAAAQARMf/aAAgBAwEBPxBTwtX/xAAXEQADAQAAAAAAAAAAAAAAAAAAARFB/9oACAECAQE/EFOlH//EABwQAQADAAIDAAAAAAAAAAAAAAEAESExcVFhof/aAAgBAQABPxC6xw8m2X+RboRIRelj55hTkojqxQB6gxdPqs//2Q==&apos;); background-size: cover; display: block;&quot;\n  &gt;&lt;/span&gt;\n  &lt;img\n        class=&quot;gatsby-resp-image-image&quot;\n        alt=&quot;View through the window of the train&quot;\n        title=&quot;View through the window of the train&quot;\n        src=&quot;/static/a9833eff2148367b26515e378a113aaf/acb04/train-view.jpg&quot;\n        srcset=&quot;/static/a9833eff2148367b26515e378a113aaf/bc01b/train-view.jpg 188w,\n/static/a9833eff2148367b26515e378a113aaf/bf173/train-view.jpg 375w,\n/static/a9833eff2148367b26515e378a113aaf/acb04/train-view.jpg 750w,\n/static/a9833eff2148367b26515e378a113aaf/ec605/train-view.jpg 1125w,\n/static/a9833eff2148367b26515e378a113aaf/c58a3/train-view.jpg 1500w,\n/static/a9833eff2148367b26515e378a113aaf/b17f8/train-view.jpg 1600w&quot;\n        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;\n        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;\n        loading=&quot;lazy&quot;\n      /&gt;\n  &lt;/a&gt;\n    &lt;/span&gt;&lt;/p&gt;\n&lt;h4&gt;Ljubljana&lt;/h4&gt;\n&lt;p&gt;Ljubljana was an amazing place. It is beautiful and has a great atmosphere. We enjoyed walking aside the river both in the evening and the morning. The riverside bars was great for relaxing with a couple of beers. We should probably have stayed longer in Ljubljana.&lt;/p&gt;\n&lt;p&gt;&lt;span\n      class=&quot;gatsby-resp-image-wrapper&quot;\n      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 750px;&quot;\n    &gt;\n      &lt;a\n    class=&quot;gatsby-resp-image-link&quot;\n    href=&quot;/static/ff846e27c6e43a251edd61292b9026a5/b17f8/ljubljana.jpg&quot;\n    style=&quot;display: block&quot;\n    target=&quot;_blank&quot;\n    rel=&quot;noopener&quot;\n  &gt;\n    &lt;span\n    class=&quot;gatsby-resp-image-background-image&quot;\n    style=&quot;padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIEAwX/xAAWAQEBAQAAAAAAAAAAAAAAAAABAAL/2gAMAwEAAhADEAAAAWaLBzec4n//xAAbEAACAgMBAAAAAAAAAAAAAAABAgADBBETEv/aAAgBAQABBQIbnRRU+WA3VYxDV+p//8QAFhEBAQEAAAAAAAAAAAAAAAAAAQAR/9oACAEDAQE/AULL/8QAFxEAAwEAAAAAAAAAAAAAAAAAAAECEf/aAAgBAgEBPwFVRrP/xAAcEAADAAEFAAAAAAAAAAAAAAAAARECEiEiMaH/2gAIAQEABj8CdRr8Jik0bIs5HSP/xAAbEAEAAwEAAwAAAAAAAAAAAAABABEhMUFRcf/aAAgBAQABPyHYI09JgK+mUJDyzsa+2IENXcMS/9oADAMBAAIAAwAAABAs7//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAEDAQE/EAh//8QAFxEBAAMAAAAAAAAAAAAAAAAAAAExYf/aAAgBAgEBPxCRbR//xAAdEAEBAAIDAAMAAAAAAAAAAAABEQAhMUFRYYGR/9oACAEBAAE/EAGqwDpOvvAGRUAQ2x18Yo4RW3+ZADt9U1hgGiDq8YCLT0Jc/9k=&apos;); background-size: cover; display: block;&quot;\n  &gt;&lt;/span&gt;\n  &lt;img\n        class=&quot;gatsby-resp-image-image&quot;\n        alt=&quot;The river running through Ljubljana&quot;\n        title=&quot;The river running through Ljubljana&quot;\n        src=&quot;/static/ff846e27c6e43a251edd61292b9026a5/acb04/ljubljana.jpg&quot;\n        srcset=&quot;/static/ff846e27c6e43a251edd61292b9026a5/bc01b/ljubljana.jpg 188w,\n/static/ff846e27c6e43a251edd61292b9026a5/bf173/ljubljana.jpg 375w,\n/static/ff846e27c6e43a251edd61292b9026a5/acb04/ljubljana.jpg 750w,\n/static/ff846e27c6e43a251edd61292b9026a5/ec605/ljubljana.jpg 1125w,\n/static/ff846e27c6e43a251edd61292b9026a5/c58a3/ljubljana.jpg 1500w,\n/static/ff846e27c6e43a251edd61292b9026a5/b17f8/ljubljana.jpg 1600w&quot;\n        sizes=&quot;(max-width: 750px) 100vw, 750px&quot;\n        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;\n        loading=&quot;lazy&quot;\n      /&gt;\n  &lt;/a&gt;\n    &lt;/span&gt;&lt;/p&gt;\n&lt;h4&gt;Beach life in Rijeka&lt;/h4&gt;\n&lt;p&gt;In Rijeka, we stayed in an apartment rented through AirBnb. The apartment was just a few hundred meters from the beach. We chilled at the beach and read books for the last days of our trip. I guess we were to busy chilling to remember to take photos.&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;Want to see more photos? Check out my &lt;a href=&quot;https://instagram.com/relekang&quot;&gt;Instagram account&lt;/a&gt;&lt;/strong&gt;&lt;/p&gt;\n&lt;h2&gt;Lessons learned&lt;/h2&gt;\n&lt;ul&gt;\n&lt;li&gt;Air-condition is worth a few bucks extra in July.&lt;/li&gt;\n&lt;li&gt;Last minute deals from hotel booking apps can be really good.&lt;/li&gt;\n&lt;li&gt;&lt;a href=&quot;http://seat61.com&quot;&gt;The Man in Seat Sixty-One&lt;/a&gt; is a great resource for train travel information.&lt;/li&gt;\n&lt;li&gt;Research the day options of night trains, in several cases they are better. We almost ended up on a night train with only sitting seats.&lt;/li&gt;\n&lt;li&gt;When booking trains a long time in advance the flexible ticket is most probably worth the cost of a special offer.&lt;/li&gt;\n&lt;li&gt;Relax and enjoy the trip. There is no reason to see everything in every place.&lt;/li&gt;\n&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Writing (latex) in Atom]]></title><description><![CDATA[These days I am writing my master thesis, which I will deliver in June.\nIt is not easy to produce content all days, so when you have one of‚Ä¶]]></description><link>https://rolflekang.com/writing-latex-in-atom</link><guid isPermaLink=\"false\">https://rolflekang.com/writing-latex-in-atom</guid><category><![CDATA[atom]]></category><category><![CDATA[writing]]></category><category><![CDATA[procrastination]]></category><pubDate>Sat, 23 May 2015 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;These days I am writing my master thesis, which I will deliver in June.\nIt is not easy to produce content all days, so when you have one of those\ndays where the words are hiding it is easy to do something else. Well,\nyesterday I customized Atom to get a better writing environment for writing\nlatex. Besides, a few of the tweaks is appropriate for general writing in Atom.&lt;/p&gt;\n&lt;p&gt;First thing first, there are some great packages that should be installed.\n&lt;code class=&quot;language-text&quot;&gt;language-latex&lt;/code&gt; gives syntax highlighting. &lt;code class=&quot;language-text&quot;&gt;make-runner&lt;/code&gt; is great if\nyou use make to build the document. &lt;code class=&quot;language-text&quot;&gt;linter-chktex&lt;/code&gt; checks the syntax of\nyour latex document.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;apm install language-latex make-runner linter-chktex&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;Secondly, lets make the writing environment more clean with some less styling.\nI put the snippet below in my &lt;code class=&quot;language-text&quot;&gt;~/.atom/styles.less&lt;/code&gt; in order to hide the\nline-number gutter and to center the text in the editor.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;scss&quot;&gt;&lt;pre class=&quot;language-scss&quot;&gt;&lt;code class=&quot;language-scss&quot;&gt;&lt;span class=&quot;token selector&quot;&gt;atom-text-editor &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n  &lt;span class=&quot;token selector&quot;&gt;&lt;span class=&quot;token parent important&quot;&gt;&amp;amp;&lt;/span&gt;[data-grammar~=latex]::shadow &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token selector&quot;&gt;.gutter-container &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n      &lt;span class=&quot;token property&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; none &lt;span class=&quot;token important&quot;&gt;!important&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n\n    &lt;span class=&quot;token selector&quot;&gt;.lines &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n      &lt;span class=&quot;token property&quot;&gt;min-width&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 700px&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n      &lt;span class=&quot;token property&quot;&gt;max-width&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 700px&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n      &lt;span class=&quot;token property&quot;&gt;margin-left&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; auto&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n      &lt;span class=&quot;token property&quot;&gt;margin-right&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; auto&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;Furthermore, I did not want the file treeview to show while editing latex files.\nThe coffescript below makes sure that the treeview is detached whenever I open\na &lt;code class=&quot;language-text&quot;&gt;.tex&lt;/code&gt;-file. It should go in &lt;code class=&quot;language-text&quot;&gt;~/.atom/init.coffee&lt;/code&gt;.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;coffeescript&quot;&gt;&lt;pre class=&quot;language-coffeescript&quot;&gt;&lt;code class=&quot;language-coffeescript&quot;&gt;path &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; require &lt;span class=&quot;token string&quot;&gt;&apos;path&apos;&lt;/span&gt;\n\natom&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;workspaceView&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;eachEditorView&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;editorView&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;\n  editor &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; editorView&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getEditor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n  &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; path&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;extname&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;editor&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;getPath&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;.tex&apos;&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt;\n      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; atom&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;workspace&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;panelContainers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;left&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;panels&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;length\n        atom&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;workspace&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;panelContainers&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;left&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;panels&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;item&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;detach&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;catch&lt;/span&gt; e\n      console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;log e&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;Then, it would be great to utilize the Atom&apos;s own spell-check. To enable it on\nlatex files just add &lt;code class=&quot;language-text&quot;&gt;text.tex.latex&lt;/code&gt; to the grammars field in the settings of\nthe spell-check packages.&lt;/p&gt;\n&lt;p&gt;At last, I have some editor settings for latex files. The snippet below should\nbe in &lt;code class=&quot;language-text&quot;&gt;~/.atom/config.cson&lt;/code&gt;.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;coffeescript&quot;&gt;&lt;pre class=&quot;language-coffeescript&quot;&gt;&lt;code class=&quot;language-coffeescript&quot;&gt;&lt;span class=&quot;token string&quot;&gt;&quot;.latex&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n  &lt;span class=&quot;token property&quot;&gt;editor&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;softWrap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;true&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;softWrapAtPreferredLineLength&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;true&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;preferredLineLength&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;fontSize&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;28&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[rmoq - a request mock cache]]></title><description><![CDATA[While working on feedhuddler.com there are tests that test the feedparsing functionality. It uses the actual feeds from their origins, which‚Ä¶]]></description><link>https://rolflekang.com/rmoq</link><guid isPermaLink=\"false\">https://rolflekang.com/rmoq</guid><category><![CDATA[python]]></category><category><![CDATA[testing]]></category><category><![CDATA[mocking]]></category><pubDate>Tue, 30 Dec 2014 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;While working on &lt;a href=&quot;https://feedhuddler.com&quot;&gt;feedhuddler.com&lt;/a&gt; there are tests that test the feedparsing functionality. It uses the actual feeds from their origins, which I think is ok for this situation. If the feeds are not longer parseable by feedhuddler the continous integration will fail and I can look into it. It could be managed by some downloaded feeds and mocking of the requests. However, I wouldn&apos;t feel comfortable by putting other peoples content in the feedhuddler repo. Furthermore, it should be easy to add a feed that is reported to break the parser without much work. The tests can take a while on the continous integration server without it beeing a big deal, but locally the time consuming tests makes it cumbersome to work test driven or to work with the tests at all.&lt;/p&gt;\n&lt;p&gt;&lt;a href=&quot;https://github.com/relekang/rmoq&quot;&gt;&lt;strong&gt;rmoq&lt;/strong&gt;&lt;/a&gt; was created to work around that problem. It listen on all requests made by the &lt;a href=&quot;http://docs.python-requests.org/en/latest/&quot;&gt;requests&lt;/a&gt; framework and intercepts them. If a request is already been cached in the cache folder it creates a response based on a local file. On the other hand, if no file exists for that url it will perform the request and save the content into a file and then return the response. Thus, if the files are already there the tests will run faster and no manual work is needed to create the local files.&lt;/p&gt;\n&lt;p&gt;A nice side-effect of using files as storage is that they can be added to the version control repo. In the case of the feedhuddler tests it is not wanted behaviour, but in other cases it might be just what you want to add these files to code repository.&lt;/p&gt;\n&lt;p&gt;The code can be found on &lt;a href=&quot;https://github.com/relekang/rmoq&quot;&gt;github.com/relekang/rmoq&lt;/a&gt; and it can be installed with pip:&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;pip &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; rmoq&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;The basic way to use it is just to add a decorator to your test:&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token decorator annotation punctuation&quot;&gt;@rmoq&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;activate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;test_fixtures&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;test_remote_call&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n    response &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; requests&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;http://example.com&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;assert&lt;/span&gt; response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;body &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Example&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;The path parameter sent in above is optional, and if left out the path will then be set to &lt;code class=&quot;language-text&quot;&gt;fixtures/&lt;/code&gt;. The test function is then wrapped in a with statement that intercepts all requests and either load them from file or fetches the content from the url and saves it to a file before returning the response.&lt;/p&gt;\n&lt;p&gt;The feedhuddler tests went from &lt;code class=&quot;language-text&quot;&gt;Ran 21 tests in 41.394s&lt;/code&gt; to &lt;code class=&quot;language-text&quot;&gt;Ran 21 tests in 1.942s&lt;/code&gt; which is quite a speedup and the tests suite is much more pleasant to work on.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[django-nopassword reached 1.0]]></title><description><![CDATA[I started the this project as way to understand django authentication backends\nabout two years ago. I read a blog post by Ben Brown about‚Ä¶]]></description><link>https://rolflekang.com/django-nopassword-one-point-o</link><guid isPermaLink=\"false\">https://rolflekang.com/django-nopassword-one-point-o</guid><category><![CDATA[django]]></category><category><![CDATA[nopassword]]></category><category><![CDATA[django-nopassword]]></category><category><![CDATA[authentication]]></category><pubDate>Fri, 03 Oct 2014 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I started the this project as way to understand django authentication backends\nabout two years ago. I read a blog post by Ben Brown about &lt;a href=&quot;http://notes.xoxco.com/post/27999787765/is-it-time-for-password-less-login&quot;&gt;password-less\nlogin&lt;/a&gt;\nand thought that it would a great case to learn custom django authentication\nbackends.&lt;/p&gt;\n&lt;p&gt;A lot has changed since then and the project has moved from being an experiment to\nsomething useful. I myself use it in production on several sites. I have heard from\nothers who also use it. I hope you all like some of the new features in this release.&lt;/p&gt;\n&lt;hr&gt;\n&lt;h3&gt;The new features since last release&lt;/h3&gt;\n&lt;p&gt;&lt;strong&gt;Rename the app to nopassword:&lt;/strong&gt; This means that from this version installed apps\nin django should list &lt;code class=&quot;language-text&quot;&gt;nopassword&lt;/code&gt; not &lt;code class=&quot;language-text&quot;&gt;django_nopassword&lt;/code&gt;. In addition all imports\nneed to point to &lt;code class=&quot;language-text&quot;&gt;nopassword&lt;/code&gt; not &lt;code class=&quot;language-text&quot;&gt;django_nopassword&lt;/code&gt;.&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;The possibility to customize code delivery:&lt;/strong&gt;\nMost of the code in the &lt;code class=&quot;language-text&quot;&gt;EmailBackend&lt;/code&gt; has been moved to a new backend called\n&lt;code class=&quot;language-text&quot;&gt;NoPasswordBackend&lt;/code&gt;. The latter is not meant to be used on its own, but it will\nmake it easier to create other backends similar to &lt;code class=&quot;language-text&quot;&gt;EmailBackend&lt;/code&gt;. With other\nwords, it has become easier to send the login codes with other technologies like\nsms.&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;Verification of the user:&lt;/strong&gt;\ndjango-nopassword uses &lt;code class=&quot;language-text&quot;&gt;user.is_active()&lt;/code&gt; to determine whether a user is still\nactive or not. In this release we moved this into its own method,\n&lt;code class=&quot;language-text&quot;&gt;NoPasswordBackend.verify_user&lt;/code&gt;, which makes it easier to create your own logic\nto verify your users.&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;Django 1.7 support:&lt;/strong&gt; Now it is tested and known to work with the released version\nof Django 1.7. Earlier it had just support for the beta 3.&lt;/p&gt;\n&lt;p&gt;&lt;strong&gt;Migrations:&lt;/strong&gt; Support for both Django 1.7 migrations and South migrations. To use\nSouth it is necessary to use version the lastest version(1.0), since it is the only\nversion that looks for migrations in &lt;code class=&quot;language-text&quot;&gt;south_migrations&lt;/code&gt;.&lt;/p&gt;\n&lt;hr&gt;\n&lt;p&gt;The test setup has also been changed to use &lt;a href=&quot;https://tox.readthedocs.org/en/latest/&quot;&gt;tox&lt;/a&gt;.\nIt makes it a lot easier to test specific django and python versions locally. I have\nto mention the new multi-dimensional configuration of environments. It makes it easier\ngenerate test environments for several python and django versions with all combinations.&lt;/p&gt;\n&lt;p&gt;If you use django-nopassword on any on your projects please let me know. I would love\nto hear about it.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Moving the blog to pelican]]></title><description><![CDATA[A couple of days ago I swapped the static site generator used at this blog\nfrom Jekyll to Pelican. It was not to much work, mostly changing‚Ä¶]]></description><link>https://rolflekang.com/moving-to-pelican</link><guid isPermaLink=\"false\">https://rolflekang.com/moving-to-pelican</guid><category><![CDATA[this]]></category><category><![CDATA[static-site]]></category><category><![CDATA[pelican]]></category><category><![CDATA[jekyll]]></category><pubDate>Wed, 07 May 2014 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;A couple of days ago I swapped the static site generator used at this blog\nfrom Jekyll to Pelican. It was not to much work, mostly changing the metadata of the posts.\nThe reason I changed engine is mostly to try out something different. I wanted to know the differences about the two of the top static site generators. It should not be surprising that I turned towards something written in python.&lt;/p&gt;\n&lt;p&gt;I configured Pelican to some level to make it behave as I wanted to. I wrote some custom path settings to remove the &lt;code class=&quot;language-text&quot;&gt;.html&lt;/code&gt; at the end of the url to each post by generating folders with index.html. The paths from jekyll where on the form &lt;code class=&quot;language-text&quot;&gt;/year/month/day/slug/&lt;/code&gt;. I still wanted to support incoming links to those parts. The urls on the new setup is in the same pattern to solve that. In time I would like to use the pattern &lt;code class=&quot;language-text&quot;&gt;/year/slug/&lt;/code&gt; or even just the slug. To do that I need to find a way to redirect the old urls. Any ideas on how to solve the redirect issue are more than welcome. The theme will probably be available at my Github profile or something similar soon.&lt;/p&gt;\n&lt;p&gt;I created a new Pelican theme for the blog. It is a work in progress. However, I think it is a great improvement over the old blog. Especially the fact that it does not load a huge css library to display something as simple as the design of this blog.&lt;/p&gt;\n&lt;h3&gt;So what about hosting?&lt;/h3&gt;\n&lt;p&gt;I still host the site at github pages, using a &lt;a href=&quot;https://github.com/relekang/rolflekang.com/blob/gh-pages/CNAME&quot;&gt;CNAME&lt;/a&gt; file to serve it on my domain &lt;a href=&quot;http://rolflekang.com&quot;&gt;rolflekang.com&lt;/a&gt;. I use a python package called &lt;a href=&quot;https://github.com/davisp/ghp-import&quot;&gt;ghp-import&lt;/a&gt; to push the generated site to Github Pages. The source of the blog is not stored in the same repository, because I do not want people to see my unfinished posts, but still track them in the repo. Therefor I have added the public repository as a remote called &lt;code class=&quot;language-text&quot;&gt;gh-pages&lt;/code&gt;. I use the Make task below to publish to github pages. The &lt;code class=&quot;language-text&quot;&gt;publish&lt;/code&gt; task that it depends on is just the standard task from the Makefile generated by &lt;code class=&quot;language-text&quot;&gt;pelican-quickstart&lt;/code&gt;.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;make&quot;&gt;&lt;pre class=&quot;language-make&quot;&gt;&lt;code class=&quot;language-make&quot;&gt;github: publish\n  cp CNAME $(OUTPUTDIR)\n  ghp-import $(OUTPUTDIR)\n  git push gh gh-pages -f&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Building a Tumblr theme with GruntJS]]></title><description><![CDATA[Building custom themes for Tumblr To create themes for Tumblr one has to create a single HTML file and paste the contents into a editor on‚Ä¶]]></description><link>https://rolflekang.com/building-tumblr-theme-with-grunt</link><guid isPermaLink=\"false\">https://rolflekang.com/building-tumblr-theme-with-grunt</guid><category><![CDATA[gruntjs]]></category><category><![CDATA[cookiecutter]]></category><category><![CDATA[tumblr]]></category><pubDate>Sun, 02 Feb 2014 00:00:00 GMT</pubDate><content:encoded>&lt;h2&gt;Building custom themes for Tumblr&lt;/h2&gt;\n&lt;p&gt;To create themes for Tumblr one has to create a single HTML file and paste the contents into a editor on Tumblr(or create it in that editor). If you like me want to separate the files into at least different files for LESS or CSS, Javascript and HTML you need a tool to generate the concated file. Doing that without a tool grows tiresome really fast.&lt;/p&gt;\n&lt;h3&gt;Grunt to the rescue.&lt;/h3&gt;\n&lt;p&gt;&lt;a href=&quot;http://gruntjs.com/&quot;&gt;GruntJS&lt;/a&gt; is a task-runner written in Javascript. It is intended to automate tiresome tasks in web projects. There are a lot of great plugins written for Grunt. A few of them has been really helpful when trying to automate the Tumblr theme process.&lt;/p&gt;\n&lt;p&gt;The Gruntfile I created does the following: compile less files, add a list of css files as inline style, copy the built file to clipboard and remove the generated files. Running &lt;code class=&quot;language-text&quot;&gt;grunt&lt;/code&gt; will place the theme in your clipboard so you can head over to Tumblr and paste it into the editor. Even better it is possible to run &lt;code class=&quot;language-text&quot;&gt;grunt watch&lt;/code&gt; to do this whenever a file is saved.&lt;/p&gt;\n&lt;h2&gt;The cookiecutter template&lt;/h2&gt;\n&lt;p&gt;I have created a cookiecutter template with a Gruntfile that generates the theme and places it in the clipboard like I described above. To use the cookiecutter project template run the command below. If you haven&apos;t heard of cookiecutter take a look at the &lt;a href=&quot;http://cookiecutter.readthedocs.org/en/latest/readme.html&quot;&gt;documentation&lt;/a&gt;. &lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;cookiecutter https://github.com/relekang/cookiecutter-tumblr-theme.git&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;h3&gt;In the future&lt;/h3&gt;\n&lt;p&gt;It would be awesome if all it took to update the theme was &lt;code class=&quot;language-text&quot;&gt;grunt deploy&lt;/code&gt;. We will have to stick with pasting it for now. That said any feedback, requests or pull-requests are highly appreciated.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Backup routine for Redis]]></title><description><![CDATA[After I created the memoris API and started to use it I had to set up a backup routine for the Redis database running behind it. I only run‚Ä¶]]></description><link>https://rolflekang.com/backup-routines-for-redisdb</link><guid isPermaLink=\"false\">https://rolflekang.com/backup-routines-for-redisdb</guid><category><![CDATA[db]]></category><category><![CDATA[backup]]></category><category><![CDATA[redis]]></category><pubDate>Thu, 24 Oct 2013 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;After I created the &lt;a href=&quot;https://github.com/relekang/memoris&quot;&gt;memoris API&lt;/a&gt; and started to use it I had to set up a backup routine for the Redis database running behind it. I only run one Redis server not a cluster.&lt;/p&gt;\n&lt;h3&gt;Lets dump some data&lt;/h3&gt;\n&lt;p&gt;Redis has a command to save .rdb file called &lt;a href=&quot;http://redis.io/commands/bgsave&quot;&gt;BGSAVE&lt;/a&gt;. The command will asynchronously save a &lt;code class=&quot;language-text&quot;&gt;dump.rdb&lt;/code&gt; file in the same folder as your redis server. This means that one probably would want to move the file and rename it. To create the dump file run the command below.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;$ redis-cli bgsave&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;It is possible to use the &lt;a href=&quot;http://redis.io/commands/save&quot;&gt;SAVE&lt;/a&gt; command as well, but I&apos;d like to do it asynchronously because ...&lt;/p&gt;\n&lt;h3&gt;Structuring backup files&lt;/h3&gt;\n&lt;p&gt;I would like to take a dump of the database every other hour. This backup is just incase of data coruption or me doing something stupid like overwriting something I should not overwrite. That said, those backups will be the base for my remote backup as well. The remote backup will be created by another machine fetching the latest backup from the server of Secure copy(scp).&lt;/p&gt;\n&lt;p&gt;I created to cron jobs that look like this:&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;  */2 * * * redis-cli bgsave\n&lt;span class=&quot;token number&quot;&gt;23&lt;/span&gt; */2 * * * &lt;span class=&quot;token function&quot;&gt;mv&lt;/span&gt; /var/lib/redis/dump.rdb /backups/redis/&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;date&lt;/span&gt; +%Y-%m-%d&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;/span&gt;.rdb&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;The last will copy the dump file to a backup directory. Since only year, month and day is specified it will only be one dump each day, but it will be overwritten every other hour of that day. There is 20 min between the two backups so I do not have to fear the second cron job running before the dump is finished. That number could be adjusted to be closer to the average time of a dump of the database size if one would want to.&lt;/p&gt;\n&lt;h3&gt;Puppet manifest&lt;/h3&gt;\n&lt;p&gt;I created a puppet manifest to create the cron jobs and to ensure that the backup directories are in place. I created a &lt;a href=&quot;https://gist.github.com/relekang/7136687&quot;&gt;gist of the puppet manifest&lt;/a&gt; if you want to clone.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;puppet&quot;&gt;&lt;pre class=&quot;language-puppet&quot;&gt;&lt;code class=&quot;language-puppet&quot;&gt;file&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;/backups&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;/backups/redis&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n  &lt;span class=&quot;token attr-name&quot;&gt;ensure&lt;/span&gt;  &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;directory&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n  &lt;span class=&quot;token attr-name&quot;&gt;owner&lt;/span&gt;   &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;root&apos;&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\ncron&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;redis-bgsave&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n  &lt;span class=&quot;token attr-name&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;redis-cli bgsave&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n  &lt;span class=&quot;token attr-name&quot;&gt;user&lt;/span&gt;    &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;root&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n  &lt;span class=&quot;token attr-name&quot;&gt;hour&lt;/span&gt;    &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;0-23/2&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n  &lt;span class=&quot;token attr-name&quot;&gt;minute&lt;/span&gt;  &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n\ncron&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;redis-move-backup&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n  &lt;span class=&quot;token attr-name&quot;&gt;command&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;mv /var/lib/redis/dump.rdb /backups/redis/`date +%Y-%m-%d`.rdb&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n  &lt;span class=&quot;token attr-name&quot;&gt;user&lt;/span&gt;    &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;root&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n  &lt;span class=&quot;token attr-name&quot;&gt;hour&lt;/span&gt;    &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;0-23/2&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n  &lt;span class=&quot;token attr-name&quot;&gt;minute&lt;/span&gt;  &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;23&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n  &lt;span class=&quot;token attr-name&quot;&gt;require&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; File&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/backups/redis&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Cron&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;redis-bgsave&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Making your Django app ready for custom users]]></title><description><![CDATA[In Django 1.5 custom users was introduced. This means that the user model can be swapped for a\ncustom model. How does this affect third‚Ä¶]]></description><link>https://rolflekang.com/django-app-custom-user</link><guid isPermaLink=\"false\">https://rolflekang.com/django-app-custom-user</guid><category><![CDATA[django]]></category><category><![CDATA[custom user]]></category><pubDate>Wed, 22 May 2013 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;In Django 1.5 custom users was introduced. This means that the user model can be swapped for a\ncustom model. How does this affect third-party apps? Foreignkeys and other relations will crash\nif they point to &lt;code class=&quot;language-text&quot;&gt;auth.User&lt;/code&gt;. It will raise a exception of the type:\n&lt;code class=&quot;language-text&quot;&gt;AttributeError: Manager isn&amp;#39;t available; User has been swapped for &amp;#39;myapp.CustomUser&amp;#39;&lt;/code&gt;&lt;/p&gt;\n&lt;h3&gt;A possible solution&lt;/h3&gt;\n&lt;p&gt;In &lt;a href=&quot;http://github.com/relekang/django-nopassword/&quot;&gt;django-nopassword&lt;/a&gt; I tried a some different approaches. I found a solution that worked well in that app. I added a file, called it &lt;em&gt;utils.py&lt;/em&gt;, did not find a more suitable name. The code is listed below:&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;# -*- coding: utf-8 -*-&lt;/span&gt;\n&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; django\n\n&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; django&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;VERSION &lt;span class=&quot;token operator&quot;&gt;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; django&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;contrib&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;auth &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; get_user_model\n    User &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; get_user_model&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n&lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; django&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;contrib&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;auth&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;models &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; User&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;Everywhere I use the User model I changed the import to &lt;code class=&quot;language-text&quot;&gt;from app_name.utils import User&lt;/code&gt; where app&lt;em&gt;name in this case was `django&lt;/em&gt;nopassword`.&lt;/p&gt;\n&lt;h3&gt;Testing&lt;/h3&gt;\n&lt;p&gt;To be certain that everything was working correctly with custom user I created some tests and &lt;a href=&quot;https://github.com/relekang/django-nopassword/tree/master/tests&quot;&gt;a test app with a custom user&lt;/a&gt;. These tests also work nicely on Django 1.4 since &lt;code class=&quot;language-text&quot;&gt;AUTH_USER_MODEL&lt;/code&gt; is ignored in earlier versions of Django. To make it easier to test with different environments I added it to &lt;a href=&quot;https://travis-ci.org/&quot;&gt;Travis&lt;/a&gt; and added a hook to the Github repository. The travis settings:&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;language&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; python\n\n&lt;span class=&quot;token key atrule&quot;&gt;python&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2.6&quot;&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2.7&quot;&lt;/span&gt;\n\n&lt;span class=&quot;token key atrule&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; DJANGO_VERSION=1.4\n  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; DJANGO_VERSION=1.5\n\n&lt;span class=&quot;token key atrule&quot;&gt;install&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; pip install psycopg2\n  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; pip install django==$DJANGO_VERSION\n\n&lt;span class=&quot;token key atrule&quot;&gt;script&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; python setup.py test\n\n&lt;span class=&quot;token key atrule&quot;&gt;before_script&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; psql &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;c &apos;create database django_nopassword;&apos; &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;U postgres&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Stats are fun]]></title><description><![CDATA[Update: PyPi stopped serving stats in may 2013. The script in this blogpost will only be able to get download counts until may 24th. More‚Ä¶]]></description><link>https://rolflekang.com/stats-are-fun</link><guid isPermaLink=\"false\">https://rolflekang.com/stats-are-fun</guid><category><![CDATA[pypstats]]></category><category><![CDATA[pypi]]></category><category><![CDATA[stats]]></category><category><![CDATA[geek-tool]]></category><pubDate>Sun, 03 Mar 2013 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;strong&gt;Update:&lt;/strong&gt; &lt;em&gt;PyPi stopped serving stats in may 2013. The script in this blogpost will only be able to get download counts until may 24th. More information can be found on the &lt;a href=&quot;http://mail.python.org/pipermail/distutils-sig/2013-May/020855.html&quot;&gt;distutils mailinglist&lt;/a&gt;. Anyways it was fun as long as it worked.&lt;/em&gt;&lt;/p&gt;\n&lt;p&gt;I recently stumbled over &lt;a href=&quot;https://pypi.python.org/pypi/pypstats&quot;&gt;pypstats&lt;/a&gt; and wanted to combine it with the power of &lt;a href=&quot;http://projects.tynsoe.org/en/geektool/&quot;&gt;Geek Tool&lt;/a&gt;. I created a shells-script to download the stats regularly and print total downloads to a text-file.&lt;/p&gt;\n&lt;p&gt;To install pypstats use &lt;code class=&quot;language-text&quot;&gt;pip install pypstats&lt;/code&gt;&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/bash&lt;/span&gt;\n&lt;span class=&quot;token assign-left variable&quot;&gt;&lt;span class=&quot;token environment constant&quot;&gt;PATH&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin\n&lt;span class=&quot;token builtin class-name&quot;&gt;cd&lt;/span&gt; ~/pypi-stats/\npyps update -q &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;project&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;\npyps total -q &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;project&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;_stats.pkl &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;project&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;-total.txt&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;It is necessary to set the path beacause crontab does not run with a environment that includes &lt;code class=&quot;language-text&quot;&gt;/usr/local/bin&lt;/code&gt;, where pypstats is installed by pip. The &lt;code class=&quot;language-text&quot;&gt;-q&lt;/code&gt; makes the operations perform quietly.&lt;/p&gt;\n&lt;p&gt;Then in Geek Tools I just added this &lt;code class=&quot;language-text&quot;&gt;cat ~/pypi-stats/&amp;lt;project&amp;gt;-total.txt&lt;/code&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Alfred scripts for Jekyll]]></title><description><![CDATA[Alfred App is the productivity application I use the most, and the one that actually boosts productivity. I recently started to use Jekyll‚Ä¶]]></description><link>https://rolflekang.com/alfred-scripts-for-jekyll</link><guid isPermaLink=\"false\">https://rolflekang.com/alfred-scripts-for-jekyll</guid><category><![CDATA[alfredapp]]></category><category><![CDATA[jekyll]]></category><category><![CDATA[shell script]]></category><pubDate>Tue, 26 Feb 2013 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;&lt;a href=&quot;http://www.alfredapp.com/&quot;&gt;Alfred App&lt;/a&gt; is the productivity application I use the most, and the one that actually boosts productivity. I recently started to use Jekyll as a blog engine. I wanted an easy way to open a new file with the default parameters already in place. The tool for the job was a shell script as a &lt;a href=&quot;http://www.alfredapp.com/powerpack/#extensions-commands&quot;&gt;Alfred extension&lt;/a&gt;&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token assign-left variable&quot;&gt;DRAFT_PATH&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;~/relekang.github.com/drafts/&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;.md\n\n&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; -f &lt;span class=&quot;token variable&quot;&gt;$DRAFT_PATH&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;\n&lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt;\n  &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;File exists&quot;&lt;/span&gt;\n  &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt; http://127.0.0.1:4000/drafts/&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;.html\n  &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$DRAFT_PATH&lt;/span&gt;\n&lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;\n  &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Creating file&quot;&lt;/span&gt;\n  &lt;span class=&quot;token function&quot;&gt;touch&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$DRAFT_PATH&lt;/span&gt;\n  &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;---&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$DRAFT_PATH&lt;/span&gt;\n  &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt; http://127.0.0.1:4000/drafts/&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;.html\n  &lt;span class=&quot;token function&quot;&gt;open&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$DRAFT_PATH&lt;/span&gt;\n&lt;span class=&quot;token keyword&quot;&gt;fi&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;&lt;em&gt;&lt;code class=&quot;language-text&quot;&gt;# { page.title }&lt;/code&gt; has double curly-brackets in the script, but I could not get Jekyll to ignore them.&lt;/em&gt;&lt;/p&gt;\n&lt;p&gt;I also wanted an easy way to add date and copy the post to &lt;code class=&quot;language-text&quot;&gt;_posts&lt;/code&gt; when I am finished writing it.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token assign-left variable&quot;&gt;DATE&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;date &lt;span class=&quot;token string&quot;&gt;&apos;+%Y-%m-%d&apos;&lt;/span&gt;\n&lt;span class=&quot;token assign-left variable&quot;&gt;DRAFT_PATH&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;~/relekang.github.com/drafts/&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;.md\n&lt;span class=&quot;token assign-left variable&quot;&gt;PUBLISH_PATH&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;~/relekang.github.com/_posts/&lt;span class=&quot;token variable&quot;&gt;$DATE&lt;/span&gt;-&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;query&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;.md\n\n&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt; -f &lt;span class=&quot;token variable&quot;&gt;$DRAFT_PATH&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;\n&lt;span class=&quot;token keyword&quot;&gt;then&lt;/span&gt;\n  &lt;span class=&quot;token function&quot;&gt;mv&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$DRAFT_PATH&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$PUBLISH_PATH&lt;/span&gt;\n  &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Post added to _posts&quot;&lt;/span&gt;\n&lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;\n  &lt;span class=&quot;token builtin class-name&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Could not find draft&quot;&lt;/span&gt;\n&lt;span class=&quot;token keyword&quot;&gt;fi&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;Both scripts are set up with Silent = True and Output = True. Silent stops Alfred\nfrom opening a terminal window. Output makes output data appear in notification center.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Use array in postgresql with django]]></title><description><![CDATA[I wanted to use arrays in postgresql for tags on this blog. I installed the packages\n and . The model for the blogposts is displayed below‚Ä¶]]></description><link>https://rolflekang.com/use-array-in-postgresql</link><guid isPermaLink=\"false\">https://rolflekang.com/use-array-in-postgresql</guid><category><![CDATA[tags]]></category><category><![CDATA[postgres]]></category><category><![CDATA[array]]></category><category><![CDATA[pgarray]]></category><category><![CDATA[django]]></category><pubDate>Sun, 27 Jan 2013 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I wanted to use arrays in postgresql for tags on this blog. I installed the packages\n&lt;code class=&quot;language-text&quot;&gt;djorm-ext-pgarray&lt;/code&gt; and &lt;code class=&quot;language-text&quot;&gt;djorm-ext-expressions&lt;/code&gt;. The model for the blogposts is displayed below. &lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; django&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;db &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; models\n&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; djorm_expressions&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;models &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; ExpressionManager\n&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; djorm_pgarray&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fields &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; ArrayField\n\n&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Post&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;models&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Model&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n    title &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; models&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;CharField&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;max_length&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n    slug &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; models&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;SlugField&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n    pub_date &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; models&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;DateField&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n    content &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; models&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;TextField&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n    tags &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ArrayField&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;dbtype&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;varchar(60)&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n    objects &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ExpressionManager&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;The tags field is using &lt;code class=&quot;language-text&quot;&gt;djorm_pgarray.fields.ArrayField&lt;/code&gt; and the ExpressionManagaer is\nneeded if one would need to make a query using the ArrayField.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Apply puppet automatically]]></title><description><![CDATA[I recently started using github web interface as editor for my puppet configuration. I wanted to be able to push a new configuration without‚Ä¶]]></description><link>https://rolflekang.com/apply-puppet-configuration-automatically</link><guid isPermaLink=\"false\">https://rolflekang.com/apply-puppet-configuration-automatically</guid><category><![CDATA[puppet]]></category><category><![CDATA[web.py]]></category><category><![CDATA[nginx]]></category><category><![CDATA[uwsgi]]></category><category><![CDATA[github]]></category><category><![CDATA[github-hooks]]></category><pubDate>Thu, 03 Jan 2013 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I recently started using github web interface as editor for my puppet configuration. I wanted to be able to push a new configuration without doing it manually, as I do not have a puppet master I wanted to try using Github hooks as in the &lt;a href=&quot;/the-github-lamp/&quot;&gt;Github lamp code&lt;/a&gt;. I have the puppet-repo cloned to &lt;code class=&quot;language-text&quot;&gt;/puppet/&lt;/code&gt; and the main manifest is in &lt;code class=&quot;language-text&quot;&gt;/puppet/manifests/site.pp&lt;/code&gt;. The code below is the web.py script. It checks the payload from Github and will only apply the configuration if changes are pushed to the master branch. A GET request would simply get a 404.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; fabric&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;api &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; local&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; lcd\n&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; web&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; json\n\nurls &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;\n    &lt;span class=&quot;token string&quot;&gt;&apos;/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;GithubHook&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n\nrender &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; web&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;template&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;render&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;.&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n\n&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;GithubHook&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;POST&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n        data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; json&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;loads&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;web&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;payload&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;ref&apos;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n            &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;ref&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;refs/heads/master&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n              &lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; lcd&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/puppet/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n                    local&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;git pull origin master&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n                    local&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;puppet apply /puppet/manifests/site.pp&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n                    &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;applied puppet&quot;&lt;/span&gt;\n        &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n            &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ref: %s&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; data&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;ref&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;\n  &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n            &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;no ref&quot;&lt;/span&gt;\n        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;\n\n    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;GET&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n        &lt;span class=&quot;token keyword&quot;&gt;raise&lt;/span&gt; web&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;notfound&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n\n\n&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; __name__ &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;__main__&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n    app &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; web&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;application&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;urls&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;globals&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n    app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n\napplication &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; web&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;application&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;urls&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;globals&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;wsgifunc&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;I running this with uWSGI and Nginx in front. To make the setup a little more secure I added deny all and allow to Github&apos;s IP-addresses.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;server &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    listen &lt;span class=&quot;token number&quot;&gt;80&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    server_name puppet.example.com&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n\n    access_log /var/log/nginx/puppet_apply.access.log&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    error_log /var/log/nginx/puppet_apply.error.log&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n\n    location / &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n        allow &lt;span class=&quot;token number&quot;&gt;207.97&lt;/span&gt;.227.253&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n        allow &lt;span class=&quot;token number&quot;&gt;50.57&lt;/span&gt;.128.197&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n        allow &lt;span class=&quot;token number&quot;&gt;108.171&lt;/span&gt;.174.178&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n        deny all&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n\n        proxy_pass         http://127.0.0.1:9060&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n        proxy_redirect     off&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n\n        proxy_set_header   Host             &lt;span class=&quot;token variable&quot;&gt;$host&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n        proxy_set_header   X-Real-IP        &lt;span class=&quot;token variable&quot;&gt;$remote_addr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n        proxy_set_header   X-Forwarded-For  &lt;span class=&quot;token variable&quot;&gt;$proxy_add_x_forwarded_for&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n\n    location &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; /favicon.ico &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n        access_log off&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n        log_not_found off&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n        &lt;span class=&quot;token builtin class-name&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;204&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;The web.py script is in &lt;code class=&quot;language-text&quot;&gt;/home/web/puppet_apply/puppet_apply.py&lt;/code&gt;. The ini-file used by uWSGI is below.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;ini&quot;&gt;&lt;pre class=&quot;language-ini&quot;&gt;&lt;code class=&quot;language-ini&quot;&gt;&lt;span class=&quot;token selector&quot;&gt;[uwsgi]&lt;/span&gt;\n&lt;span class=&quot;token constant&quot;&gt;chdir&lt;/span&gt; &lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; /home/web/puppet_apply&lt;/span&gt;\n&lt;span class=&quot;token constant&quot;&gt;virtualenv&lt;/span&gt; &lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; /home/web/puppet_apply/venv&lt;/span&gt;\n&lt;span class=&quot;token constant&quot;&gt;pythonpath&lt;/span&gt; &lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; /home/web/puppet_apply&lt;/span&gt;\n&lt;span class=&quot;token constant&quot;&gt;procname-prefix&lt;/span&gt; &lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; puppet_apply&lt;/span&gt;\n&lt;span class=&quot;token constant&quot;&gt;daemonize&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;/var/log/uwsgi/puppet_apply.log&lt;/span&gt;\n&lt;span class=&quot;token constant&quot;&gt;wsgi-file&lt;/span&gt; &lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; /home/web/puppet_apply/puppet_apply.py&lt;/span&gt;\n&lt;span class=&quot;token constant&quot;&gt;http-socket&lt;/span&gt; &lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; 0.0.0.0:9060&lt;/span&gt;\n&lt;span class=&quot;token constant&quot;&gt;master&lt;/span&gt; &lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; True&lt;/span&gt;\n&lt;span class=&quot;token constant&quot;&gt;processes&lt;/span&gt; &lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt; 1&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[Readable Wikipedia]]></title><description><![CDATA[I have been reading a lot of wikipedia articles lately so I made a stylebot stylesheet to make it a little bit more comfortable to read. If‚Ä¶]]></description><link>https://rolflekang.com/readable-wikipedia</link><guid isPermaLink=\"false\">https://rolflekang.com/readable-wikipedia</guid><category><![CDATA[wikipedia]]></category><category><![CDATA[css]]></category><category><![CDATA[readability]]></category><category><![CDATA[stylebot]]></category><pubDate>Sun, 02 Dec 2012 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;I have been reading a lot of wikipedia articles lately so I made a stylebot stylesheet to make it a little bit more comfortable to read. If you have some enhancement tips please comment on &lt;a href=&quot;https://gist.github.com/4190383&quot;&gt;the gist&lt;/a&gt;.&lt;/p&gt;\n&lt;p&gt;&lt;img src=&quot;/images/wikipedia.png&quot; alt=&quot;Wikipedia&quot;&gt;&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;css&quot;&gt;&lt;pre class=&quot;language-css&quot;&gt;&lt;code class=&quot;language-css&quot;&gt;&lt;span class=&quot;token selector&quot;&gt;#content, #mw-head-base&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;margin-left&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 0&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n\n&lt;span class=&quot;token selector&quot;&gt;#left-navigation,\n#right-navigation&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;margin-top&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 0&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;top&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 0&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n\n&lt;span class=&quot;token selector&quot;&gt;#mw-content-text&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Georgia&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;font-size&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 18px&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;line-height&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 1.8em&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n\n&lt;span class=&quot;token selector&quot;&gt;#mw-content-text,\n#firstHeading,\n#siteSub, \ncontentSub,\n#mw-articlefeedback&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;display&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; block&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;margin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 0 auto&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;max-width&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 800px&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 100%&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n\n&lt;span class=&quot;token selector&quot;&gt;#mw-page-base&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;height&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 2.5em&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n\n&lt;span class=&quot;token selector&quot;&gt;#mw-panel&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;overflow&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; hidden&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 10px&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n\n&lt;span class=&quot;token selector&quot;&gt;#mw-panel:hover&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 120px&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n\n&lt;span class=&quot;token selector&quot;&gt;#toc&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Helvetica Neue&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;font-size&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 12px&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;opacity&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 0.3&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;position&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; fixed&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;right&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 1em&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;top&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 4em&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n\n&lt;span class=&quot;token selector&quot;&gt;.metadata, \n.dablink, \n.infobox, \n.vertical-navbox, \n.citation, \n.references, \n.external&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Helvetica&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;font-size&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 11px&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;line-height&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 14px&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n\n&lt;span class=&quot;token selector&quot;&gt;pre&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;font-family&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; monaco&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;font-size&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 13px&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token property&quot;&gt;line-height&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 16px&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[django-nopassword]]></title><description><![CDATA[Some weeks ago I read a blog post by Ben Brown about password less login. I wanted to learn more about custom authentication in Django and I‚Ä¶]]></description><link>https://rolflekang.com/django-nopassword</link><guid isPermaLink=\"false\">https://rolflekang.com/django-nopassword</guid><category><![CDATA[django]]></category><category><![CDATA[no-password]]></category><category><![CDATA[email-authentication]]></category><category><![CDATA[authentication]]></category><pubDate>Fri, 28 Sep 2012 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;Some weeks ago I read a &lt;a href=&quot;http://notes.xoxco.com/post/27999787765/is-it-time-for-password-less-login&quot;&gt;blog post&lt;/a&gt; by Ben Brown about password less login. I wanted to learn more about custom authentication in Django and I thought that implementing password less login would be good way to learn.&lt;/p&gt;\n&lt;h4&gt;Build status&lt;/h4&gt;\n&lt;p&gt;&lt;a href=&quot;https://travis-ci.org/relekang/django-nopassword&quot;&gt;&lt;img src=&quot;https://travis-ci.org/relekang/django-nopassword.png&quot; alt=&quot;Build Status&quot;&gt;&lt;/a&gt;&lt;/p&gt;\n&lt;h2&gt;Installation&lt;/h2&gt;\n&lt;p&gt;Run this command to install django-nopassword&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;pip install django-nopassword&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;h2&gt;Usage&lt;/h2&gt;\n&lt;p&gt;Add the app to installed apps&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;INSTALLED_APPS &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;\n    &lt;span class=&quot;token string&quot;&gt;&apos;nopassword&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;Set the authentication backend to &lt;em&gt;EmailBackend&lt;/em&gt;&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;AUTHENTICATION_BACKENDS &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;\n     &lt;span class=&quot;token string&quot;&gt;&apos;nopassword.backends.EmailBackend&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; \n&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;Add urls to your &lt;em&gt;urls.py&lt;/em&gt;&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;urlpatterns &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; patterns&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;\n    url&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;r&apos;^accounts/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; include&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;nopassword.urls&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[The Github lamp]]></title><description><![CDATA[Update: This project is now on github: relekang/lumen My arduino has been collecting dust in a drawer for a while. This weekend I figured‚Ä¶]]></description><link>https://rolflekang.com/the-github-lamp</link><guid isPermaLink=\"false\">https://rolflekang.com/the-github-lamp</guid><category><![CDATA[arduino]]></category><category><![CDATA[github]]></category><category><![CDATA[git]]></category><category><![CDATA[web.py]]></category><pubDate>Sun, 16 Sep 2012 00:00:00 GMT</pubDate><content:encoded>&lt;blockquote&gt;\n&lt;p&gt;Update: This project is now on github: &lt;a href=&quot;http://github.com/relekang/lumen&quot;&gt;relekang/lumen&lt;/a&gt;&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;p&gt;My arduino has been collecting dust in a drawer for a while. This weekend I figured why not hook it up with github post-receive hooks and do something cool. The hooks can be set up in the &lt;em&gt;Service Hooks&lt;/em&gt; section of a repository&apos;s admin page on github. Just add a url to where the web.py site is running and github will send that url a POST request everytime someone pushes a commit to the repository. You can fin more info about post-receive hooks at &lt;a href=&quot;https://help.github.com/articles/post-receive-hooks&quot;&gt;help.github.com&lt;/a&gt;.&lt;/p&gt;\n&lt;p&gt;About two years ago I rebuilt a IKEA children-lamp to be controllable with high/low digital signals.&lt;/p&gt;\n&lt;p&gt;&lt;span\n      class=&quot;gatsby-resp-image-wrapper&quot;\n      style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 600px;&quot;\n    &gt;\n      &lt;a\n    class=&quot;gatsby-resp-image-link&quot;\n    href=&quot;/static/45313a5d337ccdcd2d96ac38c120353b/b4294/github-lamp.jpg&quot;\n    style=&quot;display: block&quot;\n    target=&quot;_blank&quot;\n    rel=&quot;noopener&quot;\n  &gt;\n    &lt;span\n    class=&quot;gatsby-resp-image-background-image&quot;\n    style=&quot;padding-bottom: 133.51063829787233%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAbABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAQFAwb/xAAWAQEBAQAAAAAAAAAAAAAAAAADAgT/2gAMAwEAAhADEAAAAUdp/SGUkVI057tMKUophp//xAAeEAABBAMAAwAAAAAAAAAAAAADAAECEgQTFBAhM//aAAgBAQABBQLoM6tlVF6gKdSdUKzI7yGNyLRJaZrH+T+P/8QAGxEAAgEFAAAAAAAAAAAAAAAAAAEDEBESE0H/2gAIAQMBAT8B1xrhkqWP/8QAGBEAAwEBAAAAAAAAAAAAAAAAAAECEgP/2gAIAQIBAT8BrrSMNjNM/8QAHBAAAgICAwAAAAAAAAAAAAAAAAEhMRARQXHh/9oACAEBAAY/AvDeo6JE3RcDahEHBQs//8QAHRABAAICAgMAAAAAAAAAAAAAAQARIUEQYVGBkf/aAAgBAQABPyExBI3G24FYMymthzA7JjKyOCXygrzEdv3Ot9hDuXl//9oADAMBAAIAAwAAABB8HEL/xAAYEQEBAQEBAAAAAAAAAAAAAAABABEhkf/aAAgBAwEBPxBYceQBkGtm/8QAFxEBAQEBAAAAAAAAAAAAAAAAAREAEP/aAAgBAgEBPxBuZRXo/8QAHhABAAICAgMBAAAAAAAAAAAAAQARITFRYRBxgUH/2gAIAQEAAT8QftX0jdpFwkWrLKn2EGAoDNTRHLht6xuIZYNei9Rwhrm2XiZ4R8RH9vRjAFKHvPl//9k=&apos;); background-size: cover; display: block;&quot;\n  &gt;&lt;/span&gt;\n  &lt;img\n        class=&quot;gatsby-resp-image-image&quot;\n        alt=&quot;The IKEA lamp&quot;\n        title=&quot;The IKEA lamp&quot;\n        src=&quot;/static/45313a5d337ccdcd2d96ac38c120353b/b4294/github-lamp.jpg&quot;\n        srcset=&quot;/static/45313a5d337ccdcd2d96ac38c120353b/bc01b/github-lamp.jpg 188w,\n/static/45313a5d337ccdcd2d96ac38c120353b/bf173/github-lamp.jpg 375w,\n/static/45313a5d337ccdcd2d96ac38c120353b/b4294/github-lamp.jpg 600w&quot;\n        sizes=&quot;(max-width: 600px) 100vw, 600px&quot;\n        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;&quot;\n        loading=&quot;lazy&quot;\n      /&gt;\n  &lt;/a&gt;\n    &lt;/span&gt;&lt;/p&gt;\n&lt;p&gt;I wrote this based on the serial example for the arduino. It turns the lamp on and off according to the commands &lt;em&gt;on&lt;/em&gt;, &lt;em&gt;off&lt;/em&gt; and &lt;em&gt;blink&lt;/em&gt;.&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;String inputString &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\nboolean stringComplete &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; false&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; led &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n\n&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setup&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n      Serial&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;begin&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;9600&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n      inputString&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;reserve&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n      &lt;span class=&quot;token function&quot;&gt;pinMode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;led&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; OUTPUT&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n\n&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;loop&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;stringComplete&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;inputString &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;on&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n            &lt;span class=&quot;token function&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;led&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; HIGH&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;inputString &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;off&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n            &lt;span class=&quot;token function&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;led&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; LOW&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;inputString &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;blink&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n            &lt;span class=&quot;token function&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;led&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; HIGH&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n            &lt;span class=&quot;token function&quot;&gt;delay&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n            &lt;span class=&quot;token function&quot;&gt;digitalWrite&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;led&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; LOW&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n            Serial&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;inputString&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n        &lt;span class=&quot;token comment&quot;&gt;// clear the string:&lt;/span&gt;\n        inputString &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n        stringComplete &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; false&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n\n&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;serialEvent&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Serial&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;available&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n        &lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; inChar &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;Serial&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;inChar &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;\\n&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n            stringComplete &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; true&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;\n            inputString &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; inChar&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;\n        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;\n&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;The arduino is connected to my mac mini. I have some python code running on the mac to write stuff onto the serial connection between the mac and the arduino. I am using &lt;a href=&quot;http://webpy.org/&quot;&gt;web.py&lt;/a&gt; and &lt;a href=&quot;http://gunicorn.org/&quot;&gt;gunicorn&lt;/a&gt; to handle the web requests. The web.py-file &lt;em&gt;lighthouse_keeper.py&lt;/em&gt; looks like this:&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;SERIALPORT &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/dev/tty.usbmodemfd121&quot;&lt;/span&gt;\n\n&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;GithubHook&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;POST&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n        send_serial_data&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;blink\\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n        data &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; json&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;loads&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;web&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;input&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;payload&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n        &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;%s pushed to %s - %s&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;%&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;\n            data&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;pusher&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;name&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n            data&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;repository&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;name&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;\n            data&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;repository&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;homepage&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;\n        &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;\n\n    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;GET&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;self&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Something is wrong&quot;&lt;/span&gt;\n\n&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;send_serial_data&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n    &lt;span class=&quot;token comment&quot;&gt;#open serial port&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n        ser &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; serial&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Serial&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;SERIALPORT&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;9600&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n    &lt;span class=&quot;token keyword&quot;&gt;except&lt;/span&gt; serial&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;SerialException&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt;\n\n    ser&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;write&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n\n    &lt;span class=&quot;token comment&quot;&gt;#close serial port&lt;/span&gt;\n    ser&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;close&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n\n&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; __name__ &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;__main__&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;\n    app &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; web&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;application&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;urls&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;globals&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n    app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;\n\napplication &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; web&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;application&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;urls&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;globals&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;wsgifunc&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;\n&lt;p&gt;To run gunicorn I just run the command:&lt;/p&gt;\n&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;gunicorn lighthouse_keeper&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item></channel></rss>",
  "status": 200,
  "headers": {
    "date": "Tue, 29 Sep 2020 13:38:16 GMT",
    "content-type": "application/xml",
    "transfer-encoding": "chunked",
    "connection": "close",
    "set-cookie": [
      "__cfduid=dbdc89368e9738428f4cb1f4ff7d498101601386696; expires=Thu, 29-Oct-20 13:38:16 GMT; path=/; domain=.rolflekang.com; HttpOnly; SameSite=Lax"
    ],
    "cache-control": "public, max-age=0, must-revalidate",
    "etag": "W/\"405adb5b869f6917c0f394c36d587845-ssl-df\"",
    "referrer-policy": "no-referrer-when-downgrade",
    "strict-transport-security": "max-age=31536000; includeSubDomains",
    "x-content-type-options": "nosniff",
    "x-frame-options": "DENY",
    "x-xss-protection": "1; mode=block",
    "age": "0",
    "vary": "Accept-Encoding",
    "x-nf-request-id": "140028e9-88a0-4299-93e3-555fe648efbb-2522063",
    "cf-cache-status": "DYNAMIC",
    "cf-request-id": "057baee53d0000dab05b329200000001",
    "expect-ct": "max-age=604800, report-uri=\"https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct\"",
    "server": "cloudflare",
    "cf-ray": "5da61a81f95bdab0-ARN"
  }
}